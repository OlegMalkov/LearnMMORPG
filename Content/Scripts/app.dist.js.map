{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/process/browser.js","webpack:///(webpack)/buildin/global.js","webpack:///./src/epicsFlow.js","webpack:///./src/index.js","webpack:///./src/storeConfig.js"],"names":["toTrueV","extractConditionV","c","value","__DEV__","process","env","buildValueSelector","condition","selectorPath","selector","parentCondition","length","x","reduce","key","selectorKey","createConditionMatcher","valueSelector","msg","messageType","type","getFields","passive","optional","resetConditionsByKeyKeys","resetConditionsByKeyAfterReducerCallKeys","sealed","isEpicCondition","dispatchMsgEffectType","dispatchBatchedMsgsEffectType","sendMsgOutsideEpicsEffectType","dispatchMsgEffectCreator","dispatchBatchedMsgsEffectCreator","batches","daEC","sendMsgOutsideEpicsEffectCreator","ReducerResult","state","scope","_state","_updateReasons","_scope","_sideEffects","doNothing","effect","push","updater","updateReason","nextState","nextScope","createUpdater","given","when","then","noActiveConditions","conditionKeysToConditionUpdaterKeys","compulsoryConditionsKeys","conditions","Object","keys","r","k","toPassive","forEach","reactsToKey","Error","conditionKey","valueKey","conditionsKeys","EffectManagerResultType","_msgsToDispatch","broadcast","promise","_promise","createEffectManager","initialState","initialScope","onEffectRequest","requestType","_effect","getInitialState","isArray","Array","getObjectKeys","hasProp","prototype","hasOwnProperty","isObject","o","isEmpty","unnest","arr","acc","el","concat","deepFreeze","freeze","undefined","getOwnPropertyNames","prop","isFrozen","findObjDiff","lhs","rhs","difference","deepEqual","a","b","i","arrA","arrB","call","deepCopy","src","_visited","_copiesVisited","Date","getTime","RegExp","len","toString","ret","slice","proto","getPrototypeOf","__proto__","dest","create","values","map","last","MatchAnyMsgType","validateUniqVcet","epics","allEpicsKeys","allVcet","vcet","vcetsCountMap","v","duplicatedVcet","filter","join","getEffectManagersInitialState","effectManagers","config","pendingEffects","printUpdater","u","updaterKey","updaterEpicStateChange","nothingChangedButObjectRecreatedWarn","updaterEpicScopeChange","updaterReqestedEffects","printEpicExecutionInfo","epicExecutionInfo","updaters","epicKey","result","traceToString","trace","executedEpicsFilter","whitespaceLength","level","executedEpicsOutputs","executedEpics","output","triggerMsg","branches","whitespace","isEpicVcet","indexOf","prevPrefix","prefix","childrenLayers","childLayer","mergeUpdaterState","epicUpdaterState","epicUpdaterStateUpdate","valuesFullfilled","mergeUpdatersState","epicUpdatersState","epicUpdatersStateUpdate","s","epicUpdterState","mergeEpic","epicState","epicStateUpdate","updatersState","mergeEpicsStateWithUpdate","epicsState","epicsStateUpdate","resultEpicsState","update","mergeEffectManagerStateWithUpdate","emState","mergeEffectManagersStateWithUpdate","effectManagersState","effectManagersStateUpdate","effectPromiseCompleteAT","findChangedConditions","changedConditions","conditionsValues","prevConditionsValues","conditionsValuesUpdate","childrenConditionsWithSelectorOrGuard","childCondition","guard","newChildValue","_prevChildValue","_prevChildValueIsUndefined","prevChildValue","_prevValue","_prevValueIsUndefined","prevValue","childrenConditionsWithoutSelectorAndGuard","createExecuteMsg","epicsMapByVcet","epicKeyByVcet","dispatch","rootConditionsByMsgType","effectManagersByRequestType","m","emk","effectManager","orderOfEpicsVcet","index","vcetToSortValue","currentMsgType","initiatedByEpic","Infinity","getTraceUpdaters","executionLevelTrace","subVcet","exsistingEpicTraceInfo","find","t","epicVcet","getNextLevelTrace","executedEpic","e","nextLevelTrace","executeMsg","msgsChain","lastReducerValuesByEpicVcetUpdaterKey","messagesToSendOutside","batchedDispatchBatches","getEpicStateUpdate","getUpdaterStateUpdate","updaterState","updaterStateUpdate","sourceMsg","rootCondition","subscriptions","cac","cacSub","sub","activeSubs","epicSubs","updatersByVcet","conditionKeysByUpdaterKey","epicVcetToBeExecuted","sort","vcet1","vcet2","targetEpicVcetMap","epicNotExecutedBecause","updaterSubs","epic","updateReasons","allEffects","updaterKeysThatChangedState","changedActiveConditionsKeys","cck","ck","some","reducerNotExecutedBecause","atLeastOneValueIsDifferent","epicUpdaterKey","lastReducerValues","reducerValues","conditionUpdaterKey","shouldLookForDifferentValuesFromLastExecution","valueUpdate","nextValue","prevState","prevScope","changedActiveConditionsKeysMap","R","stateUpdated","scopeUpdated","updaterTraceInfo","didNothing","epicScope","dispatchMsgEffect","msgToDispatch","epicChangedEvent","effectRequestType","sendMsgOusideOfEpicsEffect","effectManagerStateUpdate","effectManagerState","requesterEpicVcet","error","computeInitialStates","epicsArr","warn","initialEpicsState","initialCondtionsValues","createComputeOutsideState","epicsVcetToStateKeyMap","findRootCondition","processConditionsSubscriptions","validateResetConditions","conditionKeyToReset","validateEpicConditions","epicsArray","globalRootConditionsByMsgType","globalSelectorsInUse","globalGuardsInUse","_createCondition","calledFromRoot","toOptional","resetConditionsByKey","resetConditionsByKeyAfterReducerCall","withGuard","existingCondition","newCondition","to","wg","withSelectorKey","wsk","withSelector","ws","match","createCondition","createEpicConditionReceiveFullMsg","createEpicCondition","createEpicWithScope","pluginConfig","createEpic","matchAnyMsgCondition","createPluginStateKey","createEpicsSubStoresByVcet","createStore","isSubStore","plugins","debug","devTools","console","log","devToolsConfig","onEpicsStateChange","outsideState","computeOutsideState","stateChangedSubscribers","batchDispatchIsInProgress","messagesAccumulatedDuringBatchDispatch","epicsStateChangedCallbackAfterBatchDispatchComplete","meta","targetEpicVcet","updatedConditionsValues","updatedEpicsState","updatedEffectManagersState","serviceState","pe","message","updatedEpicsTypes","noBatchDispatchBatches","outMsgSubscribers","nextServiceState","atLeastOneChange","send","msgs","epicSubStore","epicsSubStoresByVcet","_setState","currentEpicState","newEpicStateState","getState","pluginInitializationComplete","pluginKey","plugin","injectUpdaters","injector","updatersMapToInject","updatersKeysToInject","injectEpics","epicsToInject","getEpics","getEpicsWithPluginConfig","epicStateKey","getAllPendingEffectsPromises","pendingEffectsPromises","requestEffectType","window","__REDUX_DEVTOOLS_EXTENSION__","connect","name","subscribe","JSON","parse","init","storeCreatedEvent","storeReplacement","_getServiceState","_getNextStateForMsgWithoutUpdatingStoreState","_serviceState","destroyEffects","recreateEffects","replaceConfig","creaceEpicsStoreConfig","currentState","subscribeOnStateChange","subscribeOutMsg","resetToInitialState","subscriber","makeMsg","extraFields","makeSimpleMsg","makeSimpleEvent","makeEvent","makeSimpleCommand","makeCommand","global","$appSetup","ctx","store","storeConfig","IncEvent","test","inc","mapState","Boolean"],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,kDAA0C,gCAAgC;AAC1E;AACA;;AAEA;AACA;AACA;AACA,gEAAwD,kBAAkB;AAC1E;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAyC,iCAAiC;AAC1E,wHAAgH,mBAAmB,EAAE;AACrI;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;;;;;;AClFA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AAC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","file":"app.dist.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","// @flow\n\nconst toTrueV = (): true => true\nconst extractConditionV =<V>(c: { value: V }): V => c.value\n\nconst __DEV__ = process.env !== 'production'\n\ntype AnyValueType = number | string | bool | Object | Array<AnyValueType> | null\ntype CompulsoryConditionFieldsType = {|\n\tmessageType: string,\n\tisEpicCondition: bool,\n\toptional: bool,\n\tpassive: bool,\n\tresetConditionsByKeyAfterReducerCallKeys: Array<string> | null,\n\tresetConditionsByKeyKeys: Array<string> | null,\n\tsealed: bool,\n|}\ntype SubscriptionType = {| conditionKey: string, epicVcet: string, passive: bool, updaterKey: string |}\nopaque type Condition<V: Object>: {\n\tmessageType: string,\n\tresetConditionsByKey: (Array<string>) => Condition<V>,\n\tresetConditionsByKeyAfterReducerCall: (Array<string>) => Condition<V>,\n\tto: () => Condition<V>,\n\ttoOptional: () => Condition<V>,\n\tvalue: V,\n\twg: <VV: V>(guard: VV => bool) => Condition<VV>,\n\twithGuard: <VV: V>(guard: VV => bool) => Condition<VV>,\n\twithSelector: <R>((value: V, prevValue: V) => R) => $Diff<Condition<R>, {| withSelector: *, withSelectorKey: *, ws: *, wsk: * |}>,\n\twithSelectorKey: <SK: $Keys<V>>(selectorKey: SK) => Condition<$ElementType<V, SK>>,\n\tws: <R>((value: V, prevValue: V) => R) => $Diff<Condition<R>, {| withSelector: *, withSelectorKey: *, ws: *, wsk: * |}>,\n\twsk: <SK: $Keys<V>>(selectorKey: SK) => Condition<$ElementType<V, SK>>,\n\tisEpicCondition: bool,\n\tmatch: AnyMsgType => V | void,\n} = {|\n\t...CompulsoryConditionFieldsType,\n\tchildrenConditionsWithSelectorOrGuard?: Array<AnyConditionType>,\n\tchildrenConditionsWithoutSelectorAndGuard?: Array<Condition<V>>,\n\tguard?: (V, V) => bool,\n\tisEpicCondition: bool,\n\tparentCondition?: AnyConditionType,\n\tresetConditionsByKey: (Array<string>) => Condition<V>,\n\tresetConditionsByKeyAfterReducerCall: (Array<string>) => Condition<V>,\n\tselector?: (V, V) => AnyValueType,\n\tselectorKey?: string,\n\tsubscriptions?: Array<SubscriptionType>,\n\tto: () => Condition<V>,\n\ttoOptional: () => Condition<V>,\n\ttoPassive: () => Condition<V>,\n\tvalue: V,\n\tvalueKey: string,\n\twg: <VV: V>(guard: VV => bool) => Condition<VV>,\n\twithGuard: <VV: V>(guard: VV => bool) => Condition<VV>,\n\twithSelector: <R>((value: V, prevValue: V) => R) => $Diff<Condition<R>, {| withSelector: *, withSelectorKey: *, ws: *, wsk: * |}>,\n\twithSelectorKey: <SK: $Keys<V>>(selectorKey: SK) => Condition<$ElementType<V, SK>>,\n\tws: <R>((value: V, prevValue: V) => R) => $Diff<Condition<R>, {| withSelector: *, withSelectorKey: *, ws: *, wsk: * |}>,\n\twsk: <SK: $Keys<V>>(selectorKey: SK) => Condition<$ElementType<V, SK>>,\n\tmatch: AnyMsgType => V | void,\n|}\ntype AnyConditionType = Condition<AnyValueType>\ntype CreateConditionPropsType = {|\n\t...CompulsoryConditionFieldsType,\n\tguard?: AnyValueType => bool,\n\tparentCondition?: AnyConditionType,\n\tresetConditionsByKeyAfterReducerCallKeys: Array<string> | null,\n\tresetConditionsByKeyKeys: Array<string> | null,\n\tsealed: bool,\n\tselector?: AnyValueType => AnyValueType,\n\tselectorKey?: string,\n|}\ntype AnyMsgType = { type: $Subtype<string> } // eslint-disable-line flowtype/require-exact-type\ntype MetaType = {| targetEpicVcet?: string[] |}\ntype DispatchType = (AnyMsgType, meta?: MetaType) => void\ntype ConditionsValuesType = { [string]: AnyValueType }\nopaque type DispatchMsgEffectType = {|\n\tmsg: { type: string },\n\ttype: typeof dispatchMsgEffectType,\n|}\nopaque type DispatchBatchedMsgsEffectType = {|\n\tbatches: Array<{| msgs: Array<AnyMsgType>, targetEpicVcet: string |}>,\n\ttype: typeof dispatchBatchedMsgsEffectType,\n|}\nopaque type SendMsgOutsideEpicsEffectType = {|\n\tmsg: any,\n\ttype: typeof sendMsgOutsideEpicsEffectType,\n|}\ntype ReducerType<S: AnyValueType, SC: Object, CV, E> = ({| R: ReducerResult<S, SC, E>, changedActiveConditionsKeysMap: $ObjMap<CV, typeof toTrueV>, scope: SC, sourceMsg: AnyMsgType, state: S, values: CV |}) => ReducerResult<S, SC, E>\ntype BuiltInEffectType = DispatchMsgEffectType | SendMsgOutsideEpicsEffectType | DispatchBatchedMsgsEffectType\ntype UpdaterType<S, SC, C: { [string]: { messageType: string } & Object }, E> = {|\n\tcompulsoryConditionsKeys: Array<$Keys<C>>,\n\tconditionKeysToConditionUpdaterKeys: Array<[string, $Keys<C>]>,\n\tconditions: C,\n\tconditionsKeys: Array<$Keys<C>>,\n\tthen: ReducerType<S, SC, $Exact<$ObjMap<C, typeof extractConditionV>>, E>,\n|}\ntype EpicValueChangedEventType<State> = {| type: string, value: State |}\nopaque type EpicType<S, SC, E, PC>: { c: Condition<S>, condition: Condition<S>, initialState: S, pluginConfig: PC | void, vcet: string } = {|\n\tc: Condition<S>,\n\tcondition: Condition<S>,\n\tinitialScope: SC,\n\tinitialState: S,\n\tpluginConfig: PC | void,\n\tupdaters: { [string]: UpdaterType<S, SC, *, E> },\n\tvcet: string,\n|}\ntype CreateEpicWithScopePropsType<S, SC, E, PC> = {|\n\tinitialScope: SC,\n\tinitialState: S,\n\tpluginConfig?: PC,\n\tupdaters: { [string]: UpdaterType<S, SC, *, E> },\n\tvcet: string,\n|}\ntype CreateEpicPropsType<S, E, PC> = {|\n\tinitialState: S,\n\tpluginConfig?: PC,\n\tupdaters: { [string]: UpdaterType<S, void, *, E> },\n\tvcet: string,\n|}\n\ntype OnEffectRequestType<S, SC, E> = ({| dispatch: DispatchType, effect: $ReadOnly<E>, requesterEpicVcet: string, scope: SC, state: $ReadOnly<S>, R: EffectManagerResultType<S> |}) => EffectManagerResultType<S>\nopaque type EffectManager<S, SC, E> = {|\n\t_effect: E,\n\tinitialScope?: SC,\n\tinitialState?: S,\n\tkey?: string,\n\tonEffectRequest: OnEffectRequestType<S, SC, E>,\n\trequestType: string,\n|}\ntype PendingEffectType<E> = {| effect: E, promise: Promise<any> |}\ntype EffectManagerStateType<S, E> = {|\n\tpendingEffects: Array<PendingEffectType<E>>,\n\tscope: Object,\n\tstate: S,\n|}\ntype EffectManagersStateType<S, E> = { [string]: EffectManagerStateType<S, E> }\ntype EffectManagerStateUpdateType = {| pendingEffects?: Array<PendingEffectType<any>>, state?: AnyValueType |}\ntype EffectManagersStateUpdateType = { [string]: EffectManagerStateUpdateType }\ntype CreateEffectManagerPropsType<E, S, SC> = {|\n\tinitialScope?: SC,\n\tinitialState?: S,\n\tonEffectRequest: OnEffectRequestType<S, SC, E>,\n\trequestType: string,\n|}\ntype CreateEffectManagerType = <E, S, SC>(CreateEffectManagerPropsType<E, S, SC>) => EffectManager<S, SC, E>\ntype PluginPropsType = {|\n\tgetEpics: () => { [string]: EpicType<any, any, any, any> },\n\tgetEpicsWithPluginConfig: () => Array<{| key: string, ...EpicType<any, any, any, any>, pluginConfig: Object |}>,\n\tinjectEpics: (epicsMapToInject: { [epicKey: string]: EpicType<any, any, any, any> }) => void,\n\tinjectUpdaters: <S, SC, E, PC>(EpicType<S, SC, E, PC> => void | { [updaterKey: string]: UpdaterType<S, SC, *, E> }) => void,\n|}\ntype PluginType = PluginPropsType => void\ntype UpdaterStateValuesFullfilledType = { [string]: bool }\ntype UpdaterStateType = {| valuesFullfilled: UpdaterStateValuesFullfilledType |}\ntype UpdaterStateUpdateType = {| valuesFullfilled: UpdaterStateValuesFullfilledType |}\ntype EpicUpdatersStateType = { [string]: UpdaterStateType }\ntype EpicUpdatersStateUpdateType = { [string]: UpdaterStateUpdateType }\ntype EpicStateType = {|\n\tscope: AnyValueType,\n\tstate: AnyValueType,\n\tupdatersState: EpicUpdatersStateType,\n|}\ntype EpicsStateType = { [key: string]: EpicStateType }\ntype EpicStateUpdateType = {|\n\tscope?: AnyValueType,\n\tstate?: AnyValueType,\n\tupdatersState: EpicUpdatersStateUpdateType,\n|}\ntype EpicsStateUpdateType = { [key: string]: EpicStateUpdateType }\ntype EpicStateChangedEventType = {|\ntype: string,\nupdateReasons?: Array<string>,\nvalue: AnyValueType,\n|}\ntype ConditonsValuesType = { [string]: AnyValueType }\ntype ConditonsValuesUpdateType = { [string]: AnyValueType }\ntype PendingEffectPromiseType = {| effect: {||}, promise: Promise<void>, requestEffectType: string |}\ntype PendingEffectPromisesType = Array<PendingEffectPromiseType>\ntype EpicUpdaterExecutionInfoType = {|\n\tchangedActiveConditionsKeys: Array<string>,\n\tdidNothing?: bool,\n\tepicScope?: Object,\n\tepicState?: AnyValueType,\n\treducerNotExecutedBecause?: string,\n\treducerValues?: Object,\n\tupdaterEpicScopeChange?: Object,\n\tupdaterEpicStateChange?: Object,\n\tupdaterKey: string,\n\tupdaterReqestedEffects?: Array<Object>,\n|}\ntype EpicExecutionInfoType = {|\n\tchildrenLayers?: Array<ExecutionLevelInfoType>,\n\tepicKey: string,\n\tepicNotExecutedBecause?: string,\n\tepicVcet: string, // eslint-disable-line\n\tupdaters?: Array<EpicUpdaterExecutionInfoType>,\n|}\ntype ExecutionLevelInfoType = {|\n\texecutedEpics: Array<EpicExecutionInfoType>,\n\ttriggerMsg: AnyMsgType,\n|}\ntype DispatchMsgsBatchesType = Array<{| msgs: Array<AnyMsgType>, targetEpicVcet: string |}>\ntype ExecuteMsgPropsType = {|\n\tmsgsChain: Array<AnyMsgType>,\n\tconditionsValues: ConditonsValuesType,\n\tconditionsValuesUpdate: ConditonsValuesUpdateType,\n\teffectManagersState: EffectManagersStateType<*, *>,\n\teffectManagersStateUpdate: EffectManagersStateUpdateType,\n\tepicsState: EpicsStateType,\n\tepicsStateUpdate: EpicsStateUpdateType,\n\tbatchedDispatchBatches: DispatchMsgsBatchesType,\n\texecutionLevelTrace: ExecutionLevelInfoType | void,\n\tlastReducerValuesByEpicVcetUpdaterKey: { [string]: Object },\n\tmessagesToSendOutside: Array<AnyMsgType>,\n\tprevConditionsValues: ConditonsValuesType,\n|}\ntype CreateExecuteMsgPropsType = {|\n\tdispatch: DispatchType,\n\teffectManagers: { [string]: EffectManager<any, any, any> },\n\tepicKeyByVcet: { [string]: string },\n\tepicsMapByVcet: { [string]: EpicType<any, any, any, any> },\n\trootConditionsByMsgType: { [string]: AnyConditionType },\n\ttrace: Function,\n\twarn: Function,\n|}\ntype EpicSubsType = { [epicVcet: string]: { [updaterKey: string]: Array<string> } }\n\nopaque type EpicsStoreType<Epics: Object>: {\n\tdispatch: DispatchType,\n\tdestroyEffects: () => void,\n\trecreateEffects: () => void,\n\tgetAllPendingEffectsPromises: () => PendingEffectPromisesType,\n\tgetState: () => $Exact<$ObjMap<Epics, typeof getInitialState>>,\n\tsubscribeOutMsg: any => any,\n\tsubscribeOnStateChange: (sub: ($Exact<$ObjMap<Epics, typeof getInitialState>>) => any) => any,\n\treplaceConfig: (CreateStorePropsType<Epics>) => void,\n\tresetToInitialState: () => void,\n\twarn: Function,\n} = {|\n\t_getNextStateForMsgWithoutUpdatingStoreState: (AnyMsgType) => $Exact<$ObjMap<Epics, typeof getInitialState>>,\n\t_getServiceState: () => { conditions: ConditionsValuesType, effectManagers: EffectManagersStateType<*, *>, epics: EpicsStateType },\n\t_setState: ServiceStateType => void,\n\tdestroyEffects: () => void,\n\trecreateEffects: () => void,\n\treplaceConfig: (CreateStorePropsType<Epics>) => void,\n\tresetToInitialState: () => void,\n\tdispatch: DispatchType,\n\tgetAllPendingEffectsPromises: () => PendingEffectPromisesType,\n\tgetState: () => $Exact<$ObjMap<Epics, typeof getInitialState>>,\n\tsubscribeOutMsg: any => any,\n\tsubscribeOnStateChange: (sub: ($Exact<$ObjMap<Epics, typeof getInitialState>>) => any) => any,\n\twarn: Function,\n|}\n\nfunction buildValueSelector<V>(condition: Condition<V>, selectorPath = [], selector) {\n\tif (!(condition: any).parentCondition) {\n\t\tif (selectorPath.length === 0 && !selector) return x => x\n\t\treturn x => {\n\t\t\tconst value = selectorPath.reduce((x, key) => x[key], x)\n\n\t\t\tif (selector) return selector(value)\n\t\t\treturn value\n\t\t}\n\t}\n\treturn buildValueSelector((condition: any).parentCondition, (condition: any).selectorKey ? [(condition: any).selectorKey, ...selectorPath] : selectorPath, (condition: any).selector ? (condition: any).selector : selector)\n}\n\nconst createConditionMatcher = <V>(condition: Condition<V>): (AnyMsgType => V | void) => {\n\tconst valueSelector = buildValueSelector(condition)\n\n\treturn (msg: AnyMsgType): V | void => {\n\t\tif (condition.messageType === msg.type) {\n\t\t\treturn valueSelector((msg: any))\n\t\t}\n\t}\n}\n\nfunction getFields(condition: AnyConditionType): {| ...CompulsoryConditionFieldsType, parentCondition: AnyConditionType |} {\n\tconst {\n\t\tmessageType,\n\t\tpassive,\n\t\toptional,\n\t\tresetConditionsByKeyKeys,\n\t\tresetConditionsByKeyAfterReducerCallKeys,\n\t\tsealed,\n\t\tisEpicCondition,\n\t} = condition\n\n\treturn {\t\tmessageType,\n\t\tpassive,\n\t\toptional,\n\t\tresetConditionsByKeyKeys,\n\t\tresetConditionsByKeyAfterReducerCallKeys,\n\t\tparentCondition: condition,\n\t\tsealed,\n\t\tisEpicCondition,\n\t}\n}\nconst dispatchMsgEffectType: 'dispatch_msg' = 'dispatch_msg'\nconst dispatchBatchedMsgsEffectType: 'dispatch_batch_msgs_into_epics' = 'dispatch_batch_msgs_into_epics' // dispatch multiple msgs into epic, but notify everybody only once\n\nconst sendMsgOutsideEpicsEffectType: 'send_msg_outside_of_epics' = 'send_msg_outside_of_epics'\nconst dispatchMsgEffectCreator = (msg: AnyMsgType): DispatchMsgEffectType => ({ type: dispatchMsgEffectType, msg })\nconst dispatchBatchedMsgsEffectCreator = (batches: DispatchMsgsBatchesType): DispatchBatchedMsgsEffectType => ({ type: dispatchBatchedMsgsEffectType, batches })\nconst daEC = dispatchMsgEffectCreator\nconst sendMsgOutsideEpicsEffectCreator = (msg: any): SendMsgOutsideEpicsEffectType => ({ type: sendMsgOutsideEpicsEffectType, msg })\n\nclass ReducerResult<S, SC, SE> {\n\t_state: S;\n\t_scope: SC;\n\t_sideEffects: Array<SE>;\n\t_updateReasons: Array<string>\n\tconstructor(state: S, scope: SC) {\n\t\tthis._state = state\n\t\tthis._updateReasons = []\n\t\tthis._scope = scope\n\t\tthis._sideEffects = []\n\t\tthis.doNothing = this\n\t}\n\tdoNothing: ReducerResult<S, SC, SE> // TODO make not chainable, throw on mixed and variance\n\tsideEffect(effect: SE): ReducerResult<S, SC, SE> {\n\t\tthis._sideEffects.push(effect)\n\t\treturn this\n\t}\n\t// update reason will be taken only if updater returned updated state\n\tmapState(updater: S => S, updateReason?: string): ReducerResult<S, SC, SE> {\n\t\tconst nextState = updater(this._state)\n\n\t\tif (updateReason && (nextState !== this._state)) {\n\t\t\tthis._updateReasons.push(updateReason)\n\t\t}\n\t\tthis._state = nextState\n\t\treturn this\n\t}\n\tmapScope(updater: SC => SC): ReducerResult<S, SC, SE> {\n\t\tconst nextScope = updater(this._scope)\n\n\t\tthis._scope = nextScope\n\t\treturn this\n\t}\n}\n\ntype MergeType<T, T1> = {| ...$Exact<T>, ...$Exact<T1> |}\nfunction createUpdater<S: AnyValueType, SC: Object, DO: { [string]: { messageType: string } & Object }, ReactsTo: { [string]: { messageType: string } & Object }, E> ({ given, when, then }: {|\n\tgiven: DO,\n\twhen: ReactsTo,\n\tthen: ({| R: ReducerResult<S, SC, E>, changedActiveConditionsKeysMap: $ObjMap<MergeType<DO, ReactsTo>, typeof toTrueV>, scope: SC, sourceMsg: AnyMsgType, state: S, values: $Exact<$ObjMap<MergeType<DO, ReactsTo>, typeof extractConditionV>> |}) => ReducerResult<S, SC, E>,\n|}): UpdaterType<S, SC, any, E> {\n\tlet noActiveConditions = true\n\tconst conditionKeysToConditionUpdaterKeys = []\n\tconst compulsoryConditionsKeys = []\n\tconst conditions = given ? ({ ...Object.keys(given).reduce((r, k: string) => ({ ...r, [k]: given[k].toPassive() }), {}), ...when }) : when\n\n\tObject.keys(when).forEach(reactsToKey => {\n\t\tif (when[reactsToKey].passive) {\n\t\t\tthrow new Error(`can not use passive condition \"${reactsToKey}\" in reacts to.`)\n\t\t}\n\t})\n\n\tObject.keys(conditions).forEach(conditionKey => {\n\t\tconst condition: AnyConditionType = conditions[conditionKey]\n\n\t\tconditionKeysToConditionUpdaterKeys.push([condition.valueKey, conditionKey])\n\t\tif (!condition.optional) {\n\t\t\tcompulsoryConditionsKeys.push(conditionKey)\n\t\t}\n\t\tif (!condition.passive) {\n\t\t\tnoActiveConditions = false\n\t\t}\n\t})\n\tif (noActiveConditions) {\n\t\tthrow new Error('createUpdater requires at least one condition to be active')\n\t}\n\n\tif (given) {\n\t\tObject.keys(given).forEach(k => {\n\t\t\tif (when[k]) throw new Error(`given can not contain same key as reacts to: ${k}`)\n\t\t})\n\t}\n\n\treturn {\n\t\tconditions,\n\t\tthen: (then: any),\n\t\tconditionKeysToConditionUpdaterKeys,\n\t\tconditionsKeys: Object.keys((conditions: any)),\n\t\tcompulsoryConditionsKeys,\n\t}\n}\n\nclass EffectManagerResultType<S> {\n\t_state: S\n\t_msgsToDispatch: Array<{| msg: AnyMsgType, broadcast?: bool |}>\n\t_promise: Promise<void>\n\tconstructor(state: S) {\n\t\tthis._state = state\n\t\tthis._msgsToDispatch = []\n\t\tthis.doNothing = this\n\t}\n\tdoNothing: EffectManagerResultType<S>\n\tmapState(updater: S => S): EffectManagerResultType<S> {\n\t\tthis._state = updater(this._state)\n\t\treturn this\n\t}\n\tdispatchMsg(msg: AnyMsgType, broadcast?: true): EffectManagerResultType<S> {\n\t\tthis._msgsToDispatch.push(({\n\t\t\tmsg,\n\t\t\tbroadcast,\n\t\t}))\n\t\treturn this\n\t}\n\twithEffectPromise(promise: Promise<void>): EffectManagerResultType<S> {\n\t\tthis._promise = promise\n\t\treturn this\n\t}\n}\n\nfunction createEffectManager<E, S, SC>({\n\tinitialState,\n\tinitialScope,\n\tonEffectRequest,\n\trequestType,\n}: CreateEffectManagerPropsType<E, S, SC>): EffectManager<S, SC, E> {\n\treturn {\n\t\trequestType,\n\t\tinitialState,\n\t\tinitialScope,\n\t\tonEffectRequest,\n\t\t_effect: (null: any),\n\t}\n}\nfunction getInitialState<S>({ initialState }: EpicType<S, any, any, any>): S { return initialState }\n\nconst isArray = Array.isArray\nconst getObjectKeys = Object.keys\nconst hasProp = Object.prototype.hasOwnProperty\nconst isObject = (o: any) => o != null && typeof o === 'object'\nconst isEmpty = (o: Object | Array<any>) => getObjectKeys((o: any)).length === 0\nconst unnest = <T>(arr: Array<Array<T> | T>): Array<T> => arr.reduce((acc, el) => acc.concat(el), [])\n\nfunction deepFreeze <O: Object | Array<any>>(o: O): O {\n\tObject.freeze(o)\n\tif (o === undefined || o === null) return o\n\tObject.getOwnPropertyNames((o: any)).forEach(function (prop) {\n\t\tif (\n\t\t\to.hasOwnProperty(prop)\n\t\t\t&& (o: any)[prop] !== null\n\t\t\t&& (typeof (o: any)[prop] === 'object' || typeof (o: any)[prop] === 'function')\n\t\t\t&& !Object.isFrozen((o: any)[prop])\n\t\t) {\n\t\t\tdeepFreeze((o: any)[prop])\n\t\t}\n\t})\n\treturn o\n}\nfunction findObjDiff(lhs: Object, rhs: Object) {\n\tif (lhs === rhs) return {}\n\tif (!isObject(lhs) || !isObject(rhs)) return [lhs, '->', rhs]\n\treturn Object.keys(rhs).reduce((acc, key) => {\n\t\tif (lhs.hasOwnProperty(key)) {\n\t\t\tconst difference = findObjDiff(lhs[key], rhs[key])\n\n\t\t\tif (isObject(difference) && isEmpty(difference)) return acc\n\t\t\treturn { ...acc, [key]: difference }\n\t\t}\n\t\treturn acc\n\t}, {})\n}\n// only serializible data (no Date/RegEx)\nfunction deepEqual(a: any, b: any) {\n\tif (a === b) return true\n\tif (a && b && typeof a == 'object' && typeof b == 'object') {\n\t\tlet i\n\n\n\t\tlet length\n\n\n\t\tlet key\n\t\tconst\n\t\t\tarrA = isArray(a)\n\n\n\t\tconst arrB = isArray(b)\n\n\t\tif (arrA && arrB) {\n\t\t\tlength = a.length\n\t\t\tif (length != b.length) return false; // eslint-disable-line\n\t\t\tfor (i = length; i-- !== 0;) {\n\t\t\t\tif (!deepEqual(a[i], b[i])) return false\n\t\t\t}\n\t\t\treturn true\n\t\t}\n\t\tif (arrA != arrB) return false; // eslint-disable-line\n\t\tconst keys = getObjectKeys(a)\n\n\t\tlength = keys.length\n\t\tif (length !== getObjectKeys(b).length) return false\n\t\tfor (i = length; i-- !== 0;) {\n\t\t\tif (!hasProp.call(b, keys[i])) return false\n\t\t}\n\t\tfor (i = length; i-- !== 0;) {\n\t\t\tkey = keys[i]\n\t\t\tif (!deepEqual(a[key], b[key])) return false\n\t\t}\n\t\treturn true\n\t}\n\treturn a!==a && b!==b; // eslint-disable-line\n}\nfunction deepCopy<T: Object | Array<any>>(src: T, _visited?: Array<Object | Array<any>>, _copiesVisited?: Array<Object | Array<any>>): T {\n\tif (src === null || typeof(src) !== 'object') {\n\t\treturn src\n\t}\n\tif (src instanceof Date) return new Date(src.getTime())\n\tif (src instanceof RegExp) return (new RegExp(src): any)\n\tif (_visited === undefined) {\n\t\t// eslint-disable-next-line no-param-reassign\n\t\t_visited = []\n\t\t// eslint-disable-next-line no-param-reassign\n\t\t_copiesVisited = []\n\t}\n\tlet i\n\tconst len = _visited.length\n\n\tfor (i = 0; i < len; i++) {\n\t\tif (src === _visited[i]) {\n\t\t\treturn (_copiesVisited: any)[i]\n\t\t}\n\t}\n\tif (Object.prototype.toString.call(src) == '[object Array]') {\n\t\tconst ret = (src: any).slice()\n\n\t\t_visited.push(src)\n\t\t// $FlowFixMe\n\t\t_copiesVisited.push(ret)\n\t\tlet i = ret.length\n\n\t\twhile (i--) {\n\t\t\tret[i] = deepCopy(ret[i], _visited, _copiesVisited)\n\t\t}\n\t\treturn ret\n\t}\n\tconst\n\t\tproto = (Object.getPrototypeOf ? Object.getPrototypeOf((src: any)): src.__proto__)\n\n\n\tconst dest = Object.create(proto)\n\n\t_visited.push(src)\n\t// $FlowFixMe\n\t_copiesVisited.push(dest)\n\tfor (const key in (src: any)) {\n\t\tdest[key] = deepCopy((src: any)[key], _visited, _copiesVisited)\n\t}\n\treturn (dest: any)\n}\nconst values = o => Object.keys(o).map(k => o[k])\nconst last = arr => arr.slice(-1)[0]\nconst MatchAnyMsgType: '*' = '*'\n\nfunction validateUniqVcet(epics) {\n\tconst allEpicsKeys = Object.keys(epics)\n\tconst allVcet = allEpicsKeys.map(k => epics[k].vcet)\n\tconst vcetsCountMap = allVcet.reduce((r, v) => {\n\t\tif (r[v]) {\n\t\t\tr[v]++\n\t\t} else {\n\t\t\tr[v] = 1\n\t\t}\n\t\treturn r\n\t}, {})\n\tconst duplicatedVcet = Object.keys(vcetsCountMap)\n\t\t.filter(v => vcetsCountMap[v] > 1)\n\n\tif (duplicatedVcet.length) {\n\t\tthrow new Error(`duplicate vcets:\\n${duplicatedVcet.map(v => `Epics ${allEpicsKeys.filter(k => epics[k].vcet === v).join(', ')} has same vcet ${v}`).join('\\n')}`)\n\t}\n}\nfunction getEffectManagersInitialState(effectManagers) {\n\tif (!effectManagers) { return {} }\n\treturn Object.keys(effectManagers).reduce((state, key) => {\n\t\tconst config = effectManagers[key]\n\n\t\tstate[config.requestType] = {\n\t\t\tstate: config.initialState,\n\t\t\tscope: deepCopy(config.initialScope),\n\t\t\tpendingEffects: [],\n\t\t}\n\t\treturn state\n\t}, {})\n}\nconst printUpdater = (u: EpicUpdaterExecutionInfoType) => `${u.updaterKey }(${[\n\tu.updaterEpicStateChange ? (u.updaterEpicStateChange === nothingChangedButObjectRecreatedWarn ? 'SW' : 'S') : '',\n\tu.updaterEpicScopeChange ? (u.updaterEpicScopeChange === nothingChangedButObjectRecreatedWarn ? 'SCW' : 'SC') : '',\n\tu.updaterReqestedEffects ? 'E' : '',\n].filter(x => x).join(',')})`\nconst printEpicExecutionInfo = (epicExecutionInfo: EpicExecutionInfoType) => {\n\tconst { updaters, epicKey } = epicExecutionInfo\n\n\tif (!updaters) return ''\n\tconst result = updaters.filter(u => u.updaterEpicStateChange || u.updaterEpicScopeChange || u.updaterReqestedEffects).map(printUpdater).join('')\n\n\tif (!result.length) return ''\n\treturn `${epicKey}[${result}]`\n}\n\nfunction traceToString(trace: ExecutionLevelInfoType, executedEpicsFilter?: EpicExecutionInfoType => bool = () => true, whitespaceLength?: number = 0, level?: number = 0): string {\n// go till you see > 1 executed epics (after calling filter) or > 1 children layers\n// measure length of output at this point, an pass it down, so we print white space in following lines\n\tconst executedEpicsOutputs = trace.executedEpics\n\t\t.filter(executedEpicsFilter)\n\t\t.map(epicExecutionInfo => ({\n\t\t\toutput: printEpicExecutionInfo(epicExecutionInfo),\n\t\t\tepicExecutionInfo,\n\t\t}))\n\t\t.filter(({ output }) => output)\t// if executedEpicsOutputs.length > 1 - branching\n\n\tif (executedEpicsOutputs.length === 0 && whitespaceLength === 0) {\n\t\treturn `${trace.triggerMsg.type} does not have any effect`\n\t}\n\tconst branches = executedEpicsOutputs.map(({ output, epicExecutionInfo }) => {\n\t\tconst whitespace = new Array(whitespaceLength).join(' ')\n\t\tconst isEpicVcet = trace.triggerMsg.type.indexOf('_VCET') !== -1\n\t\tconst prevPrefix = `${whitespace}${level !== 0 && isEpicVcet ? '' : trace.triggerMsg.type}${level !== 0 ? '|':' '}=> `\n\t\tconst prefix = `${prevPrefix}${output}`\n\n\t\tif (!epicExecutionInfo.childrenLayers) return prefix\n\t\treturn [prefix, ...epicExecutionInfo.childrenLayers.map(childLayer => traceToString(childLayer, executedEpicsFilter, prevPrefix.length + 1, level + 1))]\n\t})\n\n\treturn unnest<string>(branches).filter(x => x).join('\\n')\n}\nfunction mergeUpdaterState(epicUpdaterState: UpdaterStateType, epicUpdaterStateUpdate: UpdaterStateUpdateType) {\n\tconst result: UpdaterStateType = {\n\t\tvaluesFullfilled: epicUpdaterStateUpdate.valuesFullfilled,\n\t}\n\n\treturn result\n}\nfunction mergeUpdatersState(epicUpdatersState: EpicUpdatersStateType, epicUpdatersStateUpdate: EpicUpdatersStateUpdateType): EpicUpdatersStateType { // eslint-disable-line max-len\n\treturn Object.keys(epicUpdatersState).reduce((s, updaterKey) => {\n\t\tconst\n\t\t\tepicUpdterState = epicUpdatersState[updaterKey]\n\n\n\t\tconst epicUpdaterStateUpdate = epicUpdatersStateUpdate[updaterKey]\n\n\t\tif (epicUpdaterStateUpdate === undefined) {\n\t\t\ts[updaterKey] = epicUpdterState\n\t\t} else {\n\t\t\ts[updaterKey] = mergeUpdaterState(epicUpdterState, epicUpdaterStateUpdate)\n\t\t}\n\t\treturn s\n\t}, {})\n}\nfunction mergeEpic(epicState: EpicStateType, epicStateUpdate: EpicStateUpdateType): EpicStateType {\n\treturn {\n\t\tupdatersState: mergeUpdatersState(epicState.updatersState, epicStateUpdate.updatersState),\n\t\tstate: epicStateUpdate.state === undefined ? epicState.state : epicStateUpdate.state,\n\t\tscope: epicStateUpdate.scope === undefined ? epicState.scope : epicStateUpdate.scope,\n\t}\n}\nfunction mergeEpicsStateWithUpdate(epicsState: EpicsStateType, epicsStateUpdate: EpicsStateUpdateType) {\n\tconst resultEpicsState = {}\n\nfor (const key in epicsState) { // eslint-disable-line\n\t\tconst\n\t\t\tstate = epicsState[key]\n\n\n\t\tconst update = epicsStateUpdate[key]\n\n\t\tresultEpicsState[key] = update === undefined ? state : mergeEpic(state, update)\n\t}\n\treturn resultEpicsState\n}\nfunction mergeEffectManagerStateWithUpdate(emState: EffectManagerStateType<*, *>, update: EffectManagerStateUpdateType): EffectManagerStateType<*, *> {\n\treturn {\n\t\tstate: update.state === undefined ? emState.state : update.state,\n\t\tpendingEffects: update.pendingEffects === undefined ? emState.pendingEffects : update.pendingEffects,\n\t\tscope: emState.scope,\n\t}\n}\nfunction mergeEffectManagersStateWithUpdate(effectManagersState: EffectManagersStateType<*, *>, effectManagersStateUpdate: EffectManagersStateUpdateType) {\n\tconst result = {}\n\n\tfor (const key in effectManagersState) {\n\t\tconst\n\t\t\tstate = effectManagersState[key]\n\n\n\t\tconst update = effectManagersStateUpdate[key]\n\n\t\tif (update === undefined) {\n\t\t\tresult[key] = state\n\t\t} else {\n\t\t\tresult[key] = mergeEffectManagerStateWithUpdate(state, update)\n\t\t}\n\t}\n\treturn result\n}\nconst effectPromiseCompleteAT = 'effect_promise_complete'\n\n// TODO consider having deepCompare option on condition, so condition will be cosidered changed only if it's value changed using deep compare\n\nconst findChangedConditions = (condition, value: Object, changedConditions, conditionsValues, prevConditionsValues, conditionsValuesUpdate) => {\n\t// $FlowFixMe condition.childrenConditionsWithSelectorOrGuard checked outside\n\tcondition.childrenConditionsWithSelectorOrGuard.forEach(childCondition => {\n\t\tconst { valueKey, guard } = childCondition\n\n\t\tlet newChildValue\n\n\t\tif (guard) {\n\t\t\tnewChildValue = value\n\t\t\tif (guard && !guard(value)) return\n\t\t\tconditionsValuesUpdate[valueKey] = value // used for next msg, will come in conditionsValues\n\t\t\tchangedConditions.push(childCondition)\n\t\t} else {\n\t\t\tconst _prevChildValue = prevConditionsValues[valueKey]\n\t\t\tconst _prevChildValueIsUndefined = _prevChildValue === undefined\n\t\t\tconst prevChildValue = _prevChildValueIsUndefined ? conditionsValues[valueKey] : _prevChildValue\n\t\t\tconst _prevValue = prevConditionsValues[valueKey]\n\t\t\tconst _prevValueIsUndefined = _prevValue === undefined\n\t\t\tconst prevValue = _prevValueIsUndefined ? conditionsValues[condition.valueKey] : _prevValue\n\n\t\t\tnewChildValue = childCondition.selector ? childCondition.selector(value, prevValue) : value[childCondition.selectorKey]\n\t\t\tif (prevChildValue === newChildValue) return\n\t\t\tprevConditionsValues[valueKey] = conditionsValuesUpdate[valueKey]\n\t\t\tif (_prevChildValueIsUndefined) {\n\t\t\t\tprevConditionsValues[valueKey] = newChildValue\n\t\t\t}\n\t\t\tconditionsValuesUpdate[valueKey] = newChildValue\n\t\t\tchangedConditions.push(childCondition)\n\t\t}\n\t\tif (childCondition.childrenConditionsWithoutSelectorAndGuard) {\n\t\t\tchangedConditions.push(...childCondition.childrenConditionsWithoutSelectorAndGuard)\n\t\t}\n\t\tif (!childCondition.childrenConditionsWithSelectorOrGuard) return\n\t\tfindChangedConditions(childCondition, newChildValue, changedConditions, conditionsValues, prevConditionsValues, conditionsValuesUpdate)\n\t})\n}\nconst nothingChangedButObjectRecreatedWarn = 'WARN: nothing changed, but new objects with same data was created'\nconst createExecuteMsg = ({\n\ttrace,\n\tepicsMapByVcet,epicKeyByVcet,\n\teffectManagers,\n\tdispatch,\n\trootConditionsByMsgType,\n}: CreateExecuteMsgPropsType) => {\n\tconst effectManagersByRequestType: { [string]: EffectManager<*, *, *> } = Object.keys(effectManagers).reduce((m, emk) => {\n\t\tconst effectManager = { ...effectManagers[emk] }\n\n\t\teffectManager.key = emk\n\t\tif (!m[effectManager.requestType]) {\n\t\t\tm[effectManager.requestType] = effectManager\n\t\t} else {\n\t\t\tthrow new Error(`duplicate effect manager request type ${effectManagers[emk].requestType} for [${emk} and ${m[effectManager.requestType].key}]`)\n\t\t}\n\t\treturn m\n\t}, {})\n\tconst orderOfEpicsVcet = Object.keys(epicsMapByVcet).reduce((r, vcet, index) => ({ ...r, [vcet]: index }), {})\n\tconst vcetToSortValue = (vcet, currentMsgType, initiatedByEpic) => {\n\t\tif (vcet === currentMsgType || (initiatedByEpic && initiatedByEpic.type === vcet)) return -Infinity\n\t\treturn orderOfEpicsVcet[vcet]\n\t}\n\tconst getTraceUpdaters = ({ executionLevelTrace, subVcet }) => {\n\t\tlet updaters\n\t\tconst exsistingEpicTraceInfo = executionLevelTrace.executedEpics.find(t => t.epicVcet === subVcet)\n\n\t\tif (exsistingEpicTraceInfo) {\n\t\t\tif (exsistingEpicTraceInfo.updaters) {\n\t\t\t\tupdaters = exsistingEpicTraceInfo.updaters\n\t\t\t} else {\n\t\t\t\tupdaters = []\n\t\t\t\texsistingEpicTraceInfo.updaters = updaters\n\t\t\t}\n\t\t} else {\n\t\t\tupdaters = []\n\t\t\texecutionLevelTrace.executedEpics.push({\n\t\t\t\tepicVcet: subVcet,\n\t\t\t\tepicKey: epicKeyByVcet[subVcet],\n\t\t\t\tupdaters,\n\t\t\t})\n\t\t}\n\t\treturn updaters\n\t}\n\tconst getNextLevelTrace = ({ executionLevelTrace, subVcet, triggerMsg }) => {\n\t\tconst executedEpic = executionLevelTrace.executedEpics.find(e => e.epicVcet === subVcet)\n\n\t\tif (!executedEpic) { throw new Error ('Unexpected trace error, please investigate how this happend.') } // should never happen, but flow can not check it\n\t\tif (!executedEpic.childrenLayers) {\n\t\t\texecutedEpic.childrenLayers = []\n\t\t}\n\t\tconst nextLevelTrace = { triggerMsg,\n\t\t\texecutedEpics: [] }\n\n\t\texecutedEpic.childrenLayers.push(nextLevelTrace)\n\t\treturn nextLevelTrace\n\t}\n\n\tfunction executeMsg({\n\t\tmsgsChain,\n\t\tconditionsValues,\n\t\tprevConditionsValues,\n\t\tconditionsValuesUpdate,\n\t\tepicsState,\n\t\tepicsStateUpdate,\n\t\teffectManagersState,\n\t\teffectManagersStateUpdate,\n\t\tlastReducerValuesByEpicVcetUpdaterKey,\n\t\tmessagesToSendOutside,\n\t\tbatchedDispatchBatches,\n\t\texecutionLevelTrace,\n\t}: ExecuteMsgPropsType): void {\n\t\tfunction getEpicStateUpdate(epicVcet) {\n\t\t\tlet epicStateUpdate: EpicStateUpdateType = epicsStateUpdate[epicVcet]\n\n\t\t\tif (!epicStateUpdate) {\n\t\t\t\tepicStateUpdate = ({ updatersState: {} }: EpicStateUpdateType)\n\t\t\t\tepicsStateUpdate[epicVcet] = epicStateUpdate // eslint-disable-line no-param-reassign\n\t\t\t}\n\t\t\treturn epicStateUpdate\n\t\t}\n\t\tfunction getUpdaterStateUpdate(epicStateUpdate, updaterState, updaterKey) {\n\t\t\tlet updaterStateUpdate: UpdaterStateUpdateType = epicStateUpdate.updatersState[updaterKey]\n\n\t\t\tif (!updaterStateUpdate) {\n\t\t\t\tepicStateUpdate.updatersState[updaterKey] = updaterStateUpdate = ({ valuesFullfilled: {...updaterState.valuesFullfilled} }: UpdaterStateUpdateType)\n\t\t\t}\n\t\t\treturn updaterStateUpdate\n\t\t}\n\t\tconst sourceMsg = last(msgsChain)\n\t\tconst msg = msgsChain[0]\n\t\tconst rootCondition: AnyConditionType | void = rootConditionsByMsgType[msg.type]\n\t\tconst subscriptions: Array<SubscriptionType> = []\n\n\t\tif (!rootCondition) return\n\n\t\tconditionsValuesUpdate[rootCondition.valueKey] = msg\n\t\tif (rootCondition.subscriptions) {\n\t\t\tsubscriptions.push(...rootCondition.subscriptions)\n\t\t}\n\t\tif (rootCondition.childrenConditionsWithoutSelectorAndGuard) {\n\t\t\trootCondition.childrenConditionsWithoutSelectorAndGuard.forEach(c => {\n\t\t\t\tif (c.subscriptions) {\n\t\t\t\t\tsubscriptions.push(...c.subscriptions)\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t\tif (rootCondition.childrenConditionsWithSelectorOrGuard) {\n\t\t\tconst changedConditions = []\n\n\t\t\tfindChangedConditions(rootCondition, msg, changedConditions, conditionsValues, prevConditionsValues, conditionsValuesUpdate)\n\t\t\tchangedConditions.forEach(cac => {\n\t\t\t\tconst { subscriptions: cacSub } = cac\n\n\t\t\t\tif (cacSub) {\n\t\t\t\t\tsubscriptions.push(...cacSub)\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t\tsubscriptions.forEach(sub => {\n\t\t\tconst { epicVcet, updaterKey, conditionKey } = sub\n\t\t\tconst epicStateUpdate = getEpicStateUpdate(epicVcet)\n\t\t\tconst epicState: EpicStateType = epicsState[epicVcet]\n\t\t\tconst updaterState = epicState.updatersState[updaterKey]\n\t\t\tconst updaterStateUpdate = getUpdaterStateUpdate(epicStateUpdate, updaterState, updaterKey)\n\n\t\t\tupdaterStateUpdate.valuesFullfilled[conditionKey] = true\n\t\t})\n\t\tconst activeSubs = subscriptions.filter(s => !s.passive)\n\n\t\tif (!activeSubs.length) return\n\t\tconst epicSubs: EpicSubsType = activeSubs.reduce((r: EpicSubsType, sub) => {\n\t\t\tconst { updaterKey, epicVcet } = sub\n\n\t\t\tlet updatersByVcet: { [updaterKey: string]: Array<string> } | void = r[epicVcet]\n\n\t\t\tif (!updatersByVcet) {\n\t\t\t\tr[epicVcet] = updatersByVcet = {}\n\t\t\t}\n\t\t\tlet conditionKeysByUpdaterKey: Array<string> | void = updatersByVcet[updaterKey]\n\n\t\t\tif (!conditionKeysByUpdaterKey) {\n\t\t\t\tupdatersByVcet[updaterKey] = conditionKeysByUpdaterKey = []\n\t\t\t}\n\t\t\tconditionKeysByUpdaterKey.push(sub.conditionKey)\n\t\t\treturn r\n\t\t}, {})\n\t\tconst messageType: string = msg.type\n\t\tconst { initiatedByEpic } = (msg: any)\n\t\tconst epicVcetToBeExecuted = Object.keys(epicSubs).sort((vcet1: string, vcet2: string) => vcetToSortValue(vcet1, messageType, initiatedByEpic) - vcetToSortValue(vcet2, messageType, initiatedByEpic))\n\n\t\tepicVcetToBeExecuted.forEach((subVcet: string) => {\n\t\t\t// $FlowFixMe\n\t\t\tif (msg.targetEpicVcetMap && !msg.targetEpicVcetMap[subVcet]) {\n\t\t\t\tif (trace && executionLevelTrace) {\n\t\t\t\t\texecutionLevelTrace.executedEpics.push({\n\t\t\t\t\t\tepicVcet: subVcet,\n\t\t\t\t\t\tepicKey: epicKeyByVcet[subVcet],\n\t\t\t\t\t\tepicNotExecutedBecause: `msg.targetEpicVcetMap ${Object.keys(msg.targetEpicVcetMap).join(', ')} does not contain ${subVcet}`,\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\treturn\n\t\t\t}\n\t\t\tconst updaterSubs = epicSubs[subVcet]\n\t\t\tconst epic = epicsMapByVcet[subVcet]\n\t\t\tconst epicState: EpicStateType = epicsState[subVcet]\n\t\t\tconst updateReasons = []\n\t\t\tconst allEffects = []\n\t\t\tconst updaterKeysThatChangedState = []\n\t\t\tconst epicStateUpdate = getEpicStateUpdate(subVcet)\n\n\t\t\tObject.keys(updaterSubs).forEach(updaterKey => {\n\t\t\t\tconst changedActiveConditionsKeys: Array<string> = updaterSubs[updaterKey]\n\t\t\t\tconst updater: UpdaterType<*, *, *, *> = epic.updaters[updaterKey]\n\t\t\t\tconst conditions: { [string]: AnyConditionType } = updater.conditions\n\t\t\t\tconst updaterState = epicState.updatersState[updaterKey]\n\t\t\t\tconst updaterStateUpdate = getUpdaterStateUpdate(epicStateUpdate, updaterState, updaterKey)\n\t\t\t\tconst { valuesFullfilled } = updaterStateUpdate\t\t\t\t// todo put resetAllConditionsBelowThis logic here\n\n\t\t\t\tchangedActiveConditionsKeys.forEach(cck => {\n\t\t\t\t\tconst { resetConditionsByKeyKeys } = conditions[cck]\n\n\t\t\t\t\tif (resetConditionsByKeyKeys) {\n\t\t\t\t\t\tresetConditionsByKeyKeys.forEach(ck => {\n\t\t\t\t\t\t\tvaluesFullfilled[ck] = false\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tif (updater.compulsoryConditionsKeys.some(k => !valuesFullfilled[k])) {\n\t\t\t\t\tif (trace && executionLevelTrace) {\n\t\t\t\t\t\tgetTraceUpdaters({ executionLevelTrace,\n\t\t\t\t\t\t\tsubVcet }).push({\n\t\t\t\t\t\t\tupdaterKey,\n\t\t\t\t\t\t\tchangedActiveConditionsKeys,\n\t\t\t\t\t\t\treducerNotExecutedBecause: `compulsory conditions keys ${updater.compulsoryConditionsKeys.filter(k => !valuesFullfilled[k]).join(', ')} are not fullifilled`,\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tlet atLeastOneValueIsDifferent = false\n\t\t\t\tconst epicUpdaterKey = `${subVcet}.${updaterKey}`\n\t\t\t\tconst lastReducerValues = lastReducerValuesByEpicVcetUpdaterKey[epicUpdaterKey]\n\t\t\t\tconst reducerValues: Object = updater.conditionKeysToConditionUpdaterKeys.reduce((v, [conditionKey, conditionUpdaterKey]) => {\n\t\t\t\t\tconst shouldLookForDifferentValuesFromLastExecution = lastReducerValues && !atLeastOneValueIsDifferent\n\n\t\t\t\t\tif (!valuesFullfilled[conditionUpdaterKey]) {\n\t\t\t\t\t\tif (shouldLookForDifferentValuesFromLastExecution) {\n\t\t\t\t\t\t\tconst condition = updater.conditions[conditionUpdaterKey]\n\n\t\t\t\t\t\t\tif (condition.isEpicCondition && lastReducerValues[conditionUpdaterKey] !== undefined) {\n\t\t\t\t\t\t\t\tatLeastOneValueIsDifferent = true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn v\n\t\t\t\t\t}\n\t\t\t\t\tconst valueUpdate = conditionsValuesUpdate[conditionKey]\n\t\t\t\t\tconst nextValue = v[conditionUpdaterKey] = valueUpdate === undefined ? conditionsValues[conditionKey] : valueUpdate\n\n\t\t\t\t\tif (shouldLookForDifferentValuesFromLastExecution) {\n\t\t\t\t\t\tconst condition = updater.conditions[conditionUpdaterKey]\n\n\t\t\t\t\t\tif (condition.isEpicCondition && lastReducerValues[conditionUpdaterKey] !== nextValue) {\n\t\t\t\t\t\t\tatLeastOneValueIsDifferent = true\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn v\n\t\t\t\t}, {}) // epic value can be changed multiple times for single user msg, this ensures that epic subscribers are called only once if nothing is changed from last call\n\n\t\t\t\tif (lastReducerValues && !atLeastOneValueIsDifferent) {\n\t\t\t\t\tif (trace && executionLevelTrace) {\n\t\t\t\t\t\tgetTraceUpdaters({ executionLevelTrace,\n\t\t\t\t\t\t\tsubVcet }).push({\n\t\t\t\t\t\t\tupdaterKey,\n\t\t\t\t\t\t\tchangedActiveConditionsKeys,\n\t\t\t\t\t\t\treducerValues,\n\t\t\t\t\t\t\treducerNotExecutedBecause: 'It was called before in execution chain and values not changed since then',\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tlastReducerValuesByEpicVcetUpdaterKey[epicUpdaterKey] = reducerValues\n\t\t\t\tconst prevState = epicStateUpdate.state === undefined ? epicState.state : epicStateUpdate.state\n\t\t\t\tconst prevScope = epicStateUpdate.scope === undefined ? epicState.scope : epicStateUpdate.scope\n\n\t\t\t\tif (__DEV__) {\n\t\t\t\t\tdeepFreeze(reducerValues)\n\t\t\t\t\tdeepFreeze(prevState)\n\t\t\t\t\tdeepFreeze(prevScope)\n\t\t\t\t}\n\t\t\t\t// TODO flow - mark everything passed inside then as $ReadOnly\n\t\t\t\tconst result = updater.then({\n\t\t\t\t\tvalues: reducerValues,\n\t\t\t\t\tstate: prevState,\n\t\t\t\t\tscope: prevScope,\n\t\t\t\t\tsourceMsg,\n\t\t\t\t\tchangedActiveConditionsKeysMap: changedActiveConditionsKeys.reduce((m, k) => { m[k] = true; return m }, {}),\n\t\t\t\t\tR: new ReducerResult(prevState, prevScope),\n\t\t\t\t})\n\n\t\t\t\tconst stateUpdated = prevState !== result._state\n\t\t\t\tconst scopeUpdated = prevScope !== result._scope\n\n\t\t\t\tif (trace && executionLevelTrace) {\n\t\t\t\t\tconst updaters = getTraceUpdaters({ executionLevelTrace, subVcet })\n\t\t\t\t\tconst updaterTraceInfo: EpicUpdaterExecutionInfoType = {\n\t\t\t\t\t\tupdaterKey,\n\t\t\t\t\t\tchangedActiveConditionsKeys,\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!stateUpdated && !scopeUpdated && !result._sideEffects.length) {\n\t\t\t\t\t\tupdaterTraceInfo.didNothing = true\n\t\t\t\t\t} else {\n\t\t\t\t\t\tupdaterTraceInfo.reducerValues = reducerValues\n\t\t\t\t\t}\n\t\t\t\t\tif (stateUpdated) {\n\t\t\t\t\t\tupdaterTraceInfo.epicState = prevState\n\t\t\t\t\t\tif (typeof prevState === 'object') {\n\t\t\t\t\t\t\tconst updaterEpicStateChange = findObjDiff(prevState, result._state)\n\n\t\t\t\t\t\t\tif (!isEmpty(updaterEpicStateChange)) {\n\t\t\t\t\t\t\t\tupdaterTraceInfo.updaterEpicStateChange = updaterEpicStateChange\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tupdaterTraceInfo.updaterEpicStateChange = nothingChangedButObjectRecreatedWarn\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tupdaterTraceInfo.updaterEpicStateChange = result._state\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (scopeUpdated) {\n\t\t\t\t\t\tupdaterTraceInfo.epicScope = prevScope\n\t\t\t\t\t\tconst updaterEpicScopeChange = findObjDiff(prevScope, result._scope)\n\n\t\t\t\t\t\tif (!isEmpty(updaterEpicScopeChange)) {\n\t\t\t\t\t\t\tupdaterTraceInfo.updaterEpicScopeChange = updaterEpicScopeChange\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tupdaterTraceInfo.updaterEpicScopeChange = nothingChangedButObjectRecreatedWarn\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (result._sideEffects.length > 0) {\n\t\t\t\t\t\tupdaterTraceInfo.updaterReqestedEffects = result._sideEffects\n\t\t\t\t\t}\n\t\t\t\t\tupdaters.push(updaterTraceInfo)\n\t\t\t\t}\n\t\t\t\tchangedActiveConditionsKeys.forEach(cck => {\n\t\t\t\t\tconst { resetConditionsByKeyAfterReducerCallKeys } = updater.conditions[cck]\n\n\t\t\t\t\tif (resetConditionsByKeyAfterReducerCallKeys) {\n\t\t\t\t\t\tresetConditionsByKeyAfterReducerCallKeys.forEach(ck => {\n\t\t\t\t\t\t\tvaluesFullfilled[ck] = false\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tif (scopeUpdated) {\n\t\t\t\t\tepicStateUpdate.scope = result._scope // eslint-disable-line no-param-reassign\n\t\t\t\t}\n\t\t\t\tif (stateUpdated) {\n\t\t\t\t\tupdaterKeysThatChangedState.push(updaterKey)\n\t\t\t\t\tepicStateUpdate.state = result._state // eslint-disable-line no-param-reassign\n\t\t\t\t\tupdateReasons.push(...result._updateReasons)\n\t\t\t\t\t// TODO is this epic has subs to it self, execute them immideately, skipping after update\n\t\t\t\t}\n\t\t\t\tconst { _sideEffects } = result\n\n\t\t\t\tif (_sideEffects.length) {\n\t\t\t\t\t_sideEffects.forEach(e => {\n\t\t\t\t\t\tif (e.type === dispatchMsgEffectType) {\n\t\t\t\t\t\t\t// we dispatching msg immediately as it may update state of same epic (e1) that requested msg dispatch\n\t\t\t\t\t\t\t// this way if some other epic(e2) has subscription to e1, e2 will we called only once, with latest updated epic state\n\t\t\t\t\t\t\tconst dispatchMsgEffect: DispatchMsgEffectType = (e: any)\n\t\t\t\t\t\t\tconst msgToDispatch: Object = dispatchMsgEffect.msg\n\n\t\t\t\t\t\t\tmsgToDispatch.initiatedByEpic = { updaterKey: e.updaterKey, type: subVcet }\n\t\t\t\t\t\t\texecuteMsg({\n\t\t\t\t\t\t\t\tmsgsChain: [dispatchMsgEffect.msg, ...msgsChain],\n\t\t\t\t\t\t\t\tconditionsValues,\n\t\t\t\t\t\t\t\tprevConditionsValues,\n\t\t\t\t\t\t\t\tconditionsValuesUpdate,\n\t\t\t\t\t\t\t\tepicsState,\n\t\t\t\t\t\t\t\tepicsStateUpdate,\n\t\t\t\t\t\t\t\teffectManagersState,\n\t\t\t\t\t\t\t\teffectManagersStateUpdate,\n\t\t\t\t\t\t\t\tlastReducerValuesByEpicVcetUpdaterKey,\n\t\t\t\t\t\t\t\tmessagesToSendOutside,\n\t\t\t\t\t\t\t\tbatchedDispatchBatches,\n\t\t\t\t\t\t\t\texecutionLevelTrace: trace && executionLevelTrace ? getNextLevelTrace({ executionLevelTrace,\n\t\t\t\t\t\t\t\t\tsubVcet,\n\t\t\t\t\t\t\t\t\ttriggerMsg: dispatchMsgEffect.msg }) : undefined,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t} else if (e.type === dispatchBatchedMsgsEffectType) {\n\t\t\t\t\t\t\tbatchedDispatchBatches.push(...e.batches)\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tallEffects.push(e)\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\tif (__DEV__) {\n\t\t\t\t\tdeepFreeze(result)\n\t\t\t\t}\n\t\t\t})\n\t\t\tif (updaterKeysThatChangedState.length) {\n\t\t\t\tconst epicChangedEvent: EpicStateChangedEventType = {\n\t\t\t\t\ttype: subVcet,\n\t\t\t\t\tvalue: epicStateUpdate.state,\n\t\t\t\t}\n\n\t\t\t\tif (updateReasons.length) {\n\t\t\t\t\tepicChangedEvent.updateReasons = updateReasons\n\t\t\t\t}\n\t\t\t\texecuteMsg({\n\t\t\t\t\tmsgsChain: [epicChangedEvent, ...msgsChain],\n\t\t\t\t\tconditionsValues,\n\t\t\t\t\tprevConditionsValues,\n\t\t\t\t\tconditionsValuesUpdate,\n\t\t\t\t\tepicsState,\n\t\t\t\t\tepicsStateUpdate,\n\t\t\t\t\teffectManagersState,\n\t\t\t\t\teffectManagersStateUpdate,\n\t\t\t\t\tlastReducerValuesByEpicVcetUpdaterKey,\n\t\t\t\t\tmessagesToSendOutside,\n\t\t\t\t\tbatchedDispatchBatches,\n\t\t\t\t\texecutionLevelTrace: trace && executionLevelTrace ? getNextLevelTrace({ executionLevelTrace,\n\t\t\t\t\t\tsubVcet,\n\t\t\t\t\t\ttriggerMsg: epicChangedEvent,\n\t\t\t\t\t}) : undefined,\n\t\t\t\t})\n\t\t\t}\n\t\t\tif (allEffects.length) {\n\t\t\t\tallEffects.forEach(e => {\n\t\t\t\t\tconst effectRequestType = e.type\n\n\t\t\t\t\tswitch (effectRequestType) {\n\t\t\t\t\tcase sendMsgOutsideEpicsEffectType: {\n\t\t\t\t\t\tconst sendMsgOusideOfEpicsEffect: SendMsgOutsideEpicsEffectType = (e: any)\n\n\t\t\t\t\t\tmessagesToSendOutside.push(sendMsgOusideOfEpicsEffect.msg)\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tdefault: {\n\t\t\t\t\t\tconst effectManager: EffectManager<*, *, *> = effectManagersByRequestType[effectRequestType]\n\t\t\t\t\t\tconst effectManagerStateUpdate = effectManagersStateUpdate[effectRequestType]\n\t\t\t\t\t\tconst effectManagerState = effectManagersState[effectRequestType]\n\t\t\t\t\t\tconst state = (effectManagerStateUpdate && effectManagerStateUpdate.state) ? effectManagerStateUpdate.state : effectManagerState.state\n\t\t\t\t\t\tconst result = effectManager.onEffectRequest({\n\t\t\t\t\t\t\teffect: e,\n\t\t\t\t\t\t\trequesterEpicVcet: subVcet,\n\t\t\t\t\t\t\tstate,\n\t\t\t\t\t\t\tscope: effectManagerState.scope,\n\t\t\t\t\t\t\tdispatch,\n\t\t\t\t\t\t\tR: new EffectManagerResultType(state),\n\t\t\t\t\t\t})\n\n\t\t\t\t\t\tif (result._state !== state) {\n\t\t\t\t\t\t\teffectManagersStateUpdate[effectRequestType] = { ...effectManagerStateUpdate, state: result._state }\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresult._msgsToDispatch.forEach(({ msg, broadcast }) => {\n\t\t\t\t\t\t\tif (!broadcast) {\n\t\t\t\t\t\t\t\t(msg: any).targetEpicVcetMap = { [subVcet]: true }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\texecuteMsg({\n\t\t\t\t\t\t\t\tmsgsChain: [msg, ...msgsChain],\n\t\t\t\t\t\t\t\tconditionsValues,\n\t\t\t\t\t\t\t\tprevConditionsValues,\n\t\t\t\t\t\t\t\tconditionsValuesUpdate,\n\t\t\t\t\t\t\t\tepicsState,\n\t\t\t\t\t\t\t\tepicsStateUpdate,\n\t\t\t\t\t\t\t\teffectManagersState,\n\t\t\t\t\t\t\t\teffectManagersStateUpdate,\n\t\t\t\t\t\t\t\tlastReducerValuesByEpicVcetUpdaterKey,\n\t\t\t\t\t\t\t\tmessagesToSendOutside,\n\t\t\t\t\t\t\t\tbatchedDispatchBatches,\n\t\t\t\t\t\t\t\texecutionLevelTrace: trace && executionLevelTrace ? getNextLevelTrace({ executionLevelTrace,\n\t\t\t\t\t\t\t\t\tsubVcet,\n\t\t\t\t\t\t\t\t\ttriggerMsg: msg,\n\t\t\t\t\t\t\t\t}) : undefined,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t})\n\n\t\t\t\t\t\tif (result._promise) {\n\t\t\t\t\t\t\tconst effect = e\n\n\t\t\t\t\t\t\teffectManagersStateUpdate[effectRequestType] = {\n\t\t\t\t\t\t\t\t...(effectManagerStateUpdate || {}),\n\t\t\t\t\t\t\t\tstate,\n\t\t\t\t\t\t\t\tpendingEffects: [\n\t\t\t\t\t\t\t\t\t...((effectManagerStateUpdate && effectManagerStateUpdate.pendingEffects) || []),\n\t\t\t\t\t\t\t\t\t{ effect, promise: result._promise },\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tresult._promise\n\t\t\t\t\t\t\t\t.then(() => dispatch({ type: effectPromiseCompleteAT,\n\t\t\t\t\t\t\t\t\teffect,\n\t\t\t\t\t\t\t\t\teffectRequestType }))\n\t\t\t\t\t\t\t\t.catch(error => dispatch({ type: effectPromiseCompleteAT,\n\t\t\t\t\t\t\t\t\teffect,\n\t\t\t\t\t\t\t\t\teffectRequestType,\n\t\t\t\t\t\t\t\t\terror }))\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t})\n\t}\n\treturn executeMsg\n}\n\nfunction computeInitialStates({ epicsArr, warn, executeMsg, trace }) {\n\tconst epicsState: EpicsStateType = epicsArr.reduce((state, epic) => {\n\t\treturn {\n\t\t\t...state,\n\t\t\t[epic.vcet]: {\n\t\t\t\tupdatersState: Object.keys(epic.updaters).reduce(\n\t\t\t\t\t(s, updaterKey) => ({\n\t\t\t\t\t\t...s,\n\t\t\t\t\t\t[updaterKey]: {\n\t\t\t\t\t\t\tvaluesFullfilled: Object.keys(epic.updaters[updaterKey].conditions).reduce((a, ck) => ({...a,\n\t\t\t\t\t\t\t\t[ck]: false }) ,{}),\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t\t{}\n\t\t\t\t),\n\t\t\t\tstate: epic.initialState,\n\t\t\t\tscope: epic.initialScope,\n\t\t\t},\n\t\t}\n\t}, {})\n\tconst epicsStateUpdate = {}\n\tconst conditionsValues = {}\n\tconst conditionsValuesUpdate = {}\n\tconst effectManagersStateUpdate = {}\n\tconst initialEpicsState: EpicsStateType = epicsArr\n\t\t.filter(epic => epic.initialState !== undefined)\n\t\t.reduce((epicsState: any, epic) => {\n\t\t\tif (epicsStateUpdate[epic.vcet] && epicsStateUpdate[epic.vcet].state) {\n\t\t\t\treturn epicsState\n\t\t\t}\n\t\t\tconst messagesToSendOutside = []\n\t\t\tconst msg = { type: epic.vcet, value: epic.initialState }\n\t\t\tconst batchedDispatchBatches = []\n\t\t\tconst executionLevelTrace = { triggerMsg: msg, executedEpics: [] }\n\n\t\t\texecuteMsg({\n\t\t\t\tmsgsChain: [(msg: EpicStateChangedEventType)],\n\t\t\t\tconditionsValues,\n\t\t\t\tprevConditionsValues: {},\n\t\t\t\tconditionsValuesUpdate,\n\t\t\t\tepicsState,\n\t\t\t\tepicsStateUpdate,\n\t\t\t\teffectManagersState: {},\n\t\t\t\teffectManagersStateUpdate,\n\t\t\t\tlastReducerValuesByEpicVcetUpdaterKey: {},\n\t\t\t\tmessagesToSendOutside,\n\t\t\t\tbatchedDispatchBatches,\n\t\t\t\texecutionLevelTrace,\n\t\t\t})\n\t\t\tif (trace) {\n\t\t\t\ttrace(executionLevelTrace)\n\t\t\t}\n\t\t\tif (messagesToSendOutside.length) {\n\t\t\t\tconst msg = 'epics should not send messages outside on initializing default state. use storeCreatedEvent.condition instead.'\n\n\t\t\t\twarn(msg, messagesToSendOutside)\n\t\t\t\tthrow new Error(msg)\n\t\t\t}\n\t\t\tif (batchedDispatchBatches.length) {\n\t\t\t\tconst msg = 'epics should not then batched dispatch on initializing default state. use storeCreatedEvent.condition instead.'\n\n\t\t\t\twarn(msg, batchedDispatchBatches)\n\t\t\t\tthrow new Error(msg)\n\t\t\t}\n\t\t\tif (Object.keys(effectManagersStateUpdate).length) {\n\t\t\t\tconst msg = 'effect managers should not be toched during intial state initialization. use storeCreatedEvent.condition instead.'\n\n\t\t\t\twarn(msg, effectManagersStateUpdate)\n\t\t\t\tthrow new Error(msg)\n\t\t\t}\n\t\t\treturn mergeEpicsStateWithUpdate(epicsState, epicsStateUpdate)\n\t\t}, epicsState)\n\n\treturn {\n\t\tinitialEpicsState,\n\t\tinitialCondtionsValues: { ...conditionsValues,\n\t\t\t...conditionsValuesUpdate },\n\t}\n}\nconst createComputeOutsideState = ({ epicsVcetToStateKeyMap }) => (state) => Object.keys(state).reduce((s, vcet) => {\n\ts[epicsVcetToStateKeyMap[vcet]] = state[vcet].state\n\treturn s\n}, {})\n\nfunction findRootCondition(condition: AnyConditionType): AnyConditionType {\n\tif (condition.parentCondition) {\n\t\treturn findRootCondition(condition.parentCondition)\n\t}\n\treturn condition\n}\n\nfunction processConditionsSubscriptions(epics) {\n\tconst rootConditionsByMsgType = {}\n\n\tObject.keys(epics).forEach(epicKey => {\n\t\tconst epic = epics[epicKey]\n\n\t\tObject.keys(epic.updaters).forEach(updaterKey => {\n\t\t\tconst updater = epic.updaters[updaterKey]\n\n\t\t\tObject.keys(updater.conditions).forEach(conditionKey => {\n\t\t\t\tconst condition: AnyConditionType = updater.conditions[conditionKey]\n\t\t\t\tconst rootCondition = findRootCondition(condition)\n\n\t\t\t\tif (!rootConditionsByMsgType[rootCondition.messageType]) {\n\t\t\t\t\trootConditionsByMsgType[rootCondition.messageType] = rootCondition\n\t\t\t\t}\n\n\t\t\t\tif (!condition.subscriptions) {\n\t\t\t\t\tcondition.subscriptions = []\n\t\t\t\t}\n\t\t\t\tcondition.subscriptions.push({\n\t\t\t\t\tepicVcet: epic.vcet,\n\t\t\t\t\tupdaterKey,\n\t\t\t\t\tconditionKey,\n\t\t\t\t\tpassive: condition.passive,\n\t\t\t\t})\n\t\t\t})\n\t\t})\n\t})\n\n\treturn rootConditionsByMsgType\n}\nfunction validateResetConditions(epics) {\n\tObject.keys(epics).forEach(epicKey => {\n\t\tconst epic = epics[epicKey]\n\n\t\tObject.keys(epic.updaters).forEach(updaterKey => {\n\t\t\tconst updater = epic.updaters[updaterKey]\n\n\t\t\tObject.keys(updater.conditions).forEach(conditionKey => {\n\t\t\t\tconst condition: AnyConditionType = updater.conditions[conditionKey]\n\n\t\t\t\tif (condition.resetConditionsByKeyKeys) {\n\t\t\t\t\tcondition.resetConditionsByKeyKeys.forEach(conditionKeyToReset => {\n\t\t\t\t\t\tif (!updater.conditions[conditionKeyToReset]) {\n\t\t\t\t\t\t\tthrow new Error(`${epicKey}.${updaterKey}.${conditionKey} resetConditionsByKeyKeys defined ${conditionKeyToReset} which is not exist in updater.conditons`)\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\tif (condition.resetConditionsByKeyAfterReducerCallKeys) {\n\t\t\t\t\tcondition.resetConditionsByKeyAfterReducerCallKeys.forEach(conditionKeyToReset => {\n\t\t\t\t\t\tif (!updater.conditions[conditionKeyToReset]) {\n\t\t\t\t\t\t\tthrow new Error(`${epicKey}.${updaterKey}.${conditionKey} resetConditionsByKeyAfterReducerCallKeys defined ${conditionKeyToReset} which is not exist in updater.conditons`)\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t})\n\t})\n}\nfunction validateEpicConditions(epics) {\n\tconst epicsArray = values(epics)\n\n\tObject.keys(epics).forEach(epicKey => {\n\t\tconst epic = epics[epicKey]\n\n\t\tObject.keys(epic.updaters).forEach(updaterKey => {\n\t\t\tconst updater = epic.updaters[updaterKey]\n\n\t\t\tObject.keys(updater.conditions).forEach(conditionKey => {\n\t\t\t\tconst condition: AnyConditionType = updater.conditions[conditionKey]\n\n\t\t\t\tif (epicsArray.some(e => e.vcet === condition.messageType) && !condition.isEpicCondition) {\n\t\t\t\t\tthrow new Error(`${epicKey}.${updaterKey}.${conditionKey} has epic valueChangedEventType: ${condition.messageType}, but was created as non epic condition`)\n\t\t\t\t}\n\t\t\t\tif (!epicsArray.some(e => e.vcet === condition.messageType) && condition.isEpicCondition) {\n\t\t\t\t\tthrow new Error(`${epicKey}.${updaterKey}.${conditionKey} was created as epic condition, but there is no epic registered with valueChangedEventType: ${condition.messageType}`)\n\t\t\t\t}\n\t\t\t})\n\t\t})\n\t})\n}\ntype CreateConditionType = <V: Object>(messageType: string) => Condition<V>\nconst globalRootConditionsByMsgType = {}\nconst globalSelectorsInUse = []\nconst globalGuardsInUse = []\n\nfunction _createCondition({\n\tmessageType,\n\tpassive,\n\toptional,\n\tselectorKey,\n\tguard,\n\tresetConditionsByKeyKeys,\n\tresetConditionsByKeyAfterReducerCallKeys,\n\tparentCondition,\n\tselector,\n\tsealed,\n\tisEpicCondition,\n}: CreateConditionPropsType, calledFromRoot) {\n// skipping parents without selectors or guards, as they are useless during changed conditions computation\n\tif (parentCondition && !parentCondition.selectorKey && !parentCondition.selector && !parentCondition.guard && parentCondition.parentCondition) {\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tparentCondition = parentCondition.parentCondition\n\t}\n\tif (selector && globalSelectorsInUse.indexOf(selector) === -1) {\n\t\tglobalSelectorsInUse.push(selector)\n\t}\n\tif (guard && globalGuardsInUse.indexOf(guard) === -1) {\n\t\tglobalGuardsInUse.push(guard)\n\t}\n\tconst condition: AnyConditionType = ({\n\t\tvalueKey: `${parentCondition ? parentCondition.valueKey : messageType}${selectorKey ? `.${selectorKey}` : ''}${selector ? (`.$$selector${ globalSelectorsInUse.indexOf(selector)}`) : ''}${guard ? `.$$guard${ globalGuardsInUse.indexOf(guard)}` : ''}`,\n\t\tparentCondition,\n\t\tmessageType,\n\t\tpassive,\n\t\toptional,\n\t\tguard,\n\t\tresetConditionsByKeyKeys,\n\t\tresetConditionsByKeyAfterReducerCallKeys,\n\t\tselector,\n\t\tisEpicCondition,\n\t\ttoPassive() {\n\t\t\treturn _createCondition({ ...getFields(condition), passive: true })\n\t\t},\n\t\ttoOptional() {\n\t\t\treturn _createCondition({ ...getFields(condition), optional: true })\n\t\t},\n\t\tresetConditionsByKey(keys) {\n\t\t\treturn _createCondition({ ...getFields(condition), resetConditionsByKeyKeys: keys })\n\t\t},\n\t\tresetConditionsByKeyAfterReducerCall(keys) {\n\t\t\treturn _createCondition({ ...getFields(condition), resetConditionsByKeyAfterReducerCallKeys: keys })\n\t\t},\n\t\t// You can have multiple guards for different levels of selectors like this: c.ws().tp().ws().tp()\n\t\twithGuard(guard) {\n\t\t\tif (condition.guard) {\n\t\t\t\tthrow new Error(`Guards can be applied only once per level. Condition \"${condition.valueKey}\" already has guard.`)\n\t\t\t}\n\t\t\tconst { childrenConditionsWithSelectorOrGuard } = condition\n\n\t\t\tif (childrenConditionsWithSelectorOrGuard) {\n\t\t\t\tconst existingCondition = childrenConditionsWithSelectorOrGuard.find(c => c.guard === guard)\n\n\t\t\t\tif (existingCondition) return existingCondition\n\t\t\t}\n\t\t\tconst newCondition = _createCondition({ ...getFields(condition), guard })\n\n\t\t\treturn newCondition\n\t\t},\n\t}: any)\n\n\tcondition.to = condition.toOptional\n\tcondition.wg = condition.withGuard\n\tif (!sealed) {\n\t\tconst withSelectorKey = (selectorKey: string): AnyConditionType => {\n\t\t\tconst { childrenConditionsWithSelectorOrGuard } = condition\n\n\t\t\tif (childrenConditionsWithSelectorOrGuard) {\n\t\t\t\tconst existingCondition = childrenConditionsWithSelectorOrGuard.find(c => c.selectorKey === selectorKey)\n\n\t\t\t\tif (existingCondition) return existingCondition\n\t\t\t}\n\t\t\treturn _createCondition({ ...getFields(condition), selectorKey })\n\t\t}\n\n\t\tcondition.withSelectorKey = (withSelectorKey: any)\n\t\tcondition.wsk = condition.withSelectorKey\n\t\tconst withSelector = selector => {\n\t\t\tconst { childrenConditionsWithSelectorOrGuard } = condition\n\n\t\t\tif (childrenConditionsWithSelectorOrGuard) {\n\t\t\t\tconst existingCondition = childrenConditionsWithSelectorOrGuard.find(c => c.selector === selector)\n\n\t\t\t\tif (existingCondition) return (existingCondition: any)\n\t\t\t}\n\t\t\treturn (_createCondition({ ...getFields(condition),\n\t\t\t\tselector,\n\t\t\t\tsealed: true }): any)\n\t\t}\n\n\t\tcondition.withSelector = withSelector\n\t\tcondition.ws = condition.withSelector\n\t\tif (selectorKey) {\n\t\t\tcondition.selectorKey = selectorKey\n\t\t}\n\t}\n\tif (parentCondition) {\n\t\tif (condition.selectorKey || condition.selector || condition.guard) {\n\t\t\tif (!parentCondition.childrenConditionsWithSelectorOrGuard) {\n\t\t\t\tparentCondition.childrenConditionsWithSelectorOrGuard = []\n\t\t\t}\n\t\t\tparentCondition.childrenConditionsWithSelectorOrGuard.push(condition)\n\t\t} else {\n\t\t\tif (!parentCondition.childrenConditionsWithoutSelectorAndGuard) {\n\t\t\t\tparentCondition.childrenConditionsWithoutSelectorAndGuard = []\n\t\t\t}\n\t\t\tparentCondition.childrenConditionsWithoutSelectorAndGuard.push(condition)\n\t\t}\n\t}\n\tif (calledFromRoot) {\n\t\tglobalRootConditionsByMsgType[messageType] = condition\n\t}\n\n\tcondition.match = createConditionMatcher(condition)\n\treturn condition\n}\nfunction createCondition<V: Object> (messageType: string, isEpicCondition?: bool = false): Condition<V> {\n\tif (globalRootConditionsByMsgType[messageType]) {\n\t\treturn globalRootConditionsByMsgType[messageType]\n\t}\n\treturn (_createCondition({\n\t\tmessageType,\n\t\tpassive: false,\n\t\toptional: false,\n\t\tresetConditionsByKeyKeys: null,\n\t\tresetConditionsByKeyAfterReducerCallKeys: null,\n\t\tsealed: false,\n\t\tisEpicCondition,\n\t}, true): any)\n}\nfunction createEpicConditionReceiveFullMsg<State>(vcet: string): Condition<EpicValueChangedEventType<State>> {\n\treturn createCondition<EpicValueChangedEventType<State>>(vcet, true)\n}\nfunction createEpicCondition<State>(vcet: string): Condition<State> {\n\treturn createEpicConditionReceiveFullMsg(vcet).withSelectorKey('value')\n}\nfunction createEpicWithScope<S, SC, E, PC>({ vcet, updaters, initialState, initialScope, pluginConfig }: CreateEpicWithScopePropsType<S, SC, E, PC>): EpicType<S, SC, E, PC> {\n\tconst c = createEpicCondition<S>(vcet)\n\n\treturn ({\n\t\tvcet,\n\t\tupdaters,\n\t\tinitialState,\n\t\tinitialScope,\n\t\tc,\n\t\tcondition: c,\n\t\tpluginConfig,\n\t})\n}\nfunction createEpic<S, E, PC>({ vcet, updaters, initialState, pluginConfig }: CreateEpicPropsType<S, E, PC>): EpicType<S, void, E, PC> {\n\treturn createEpicWithScope({\n\t\tvcet,\n\t\tupdaters,\n\t\tinitialState,\n\t\tinitialScope: undefined,\n\t\tpluginConfig,\n\t})\n}\nconst matchAnyMsgCondition: Condition<typeof MatchAnyMsgType> = createCondition(MatchAnyMsgType)// TODO put correct annotation\n\nconst createPluginStateKey = (key: string) => `plugin/${key}`\n\nfunction createEpicsSubStoresByVcet(epics: { [string]: EpicType<*, *, *, *> }): { [epicKey: string]: EpicsStoreType<any> } {\n\treturn getObjectKeys(epics).reduce((result, epicKey) => {\n\t\tconst epic = epics[epicKey]\n\n\t\tresult[epic.vcet] = createStore({ epics: { [epicKey]: epic }, isSubStore: true })\n\t\treturn result\n\t}, {})\n}\n\ntype ServiceStateType = {|\n\tconditions: ConditionsValuesType,\n\teffectManagers: EffectManagersStateType<AnyValueType, any>,\n\tepics: EpicsStateType,\n|}\n\ntype DevToolsConfigType = Object\n\ntype CreateStorePropsType<Epics> = {|\n\tdebug?: bool | {| devTools?: { config: DevToolsConfigType }, trace?: Function, warn?: Function |},\n\teffectManagers?: { [string]: EffectManager<*, *, *> },\n\tepics: Epics,\n\tplugins?: { [string]: PluginType },\n\tisSubStore?: true,\n|}\n\nfunction createStore<Epics: { [string]: EpicType<*, *, *, *> }> ({\n\tepics,\n\teffectManagers = {},\n\tplugins = {},\n\tdebug,\n\tisSubStore,\n}: CreateStorePropsType<Epics>): EpicsStoreType<Epics> {\n\t// eslint-disable-next-line no-console\n\tconst { warn = (() => null: Function), trace, devTools: devToolsConfig } = debug === true ? { devTools: { config: { } }, warn: undefined, trace: e => console.log(traceToString(e))} : (debug || {})\n\n\tlet devTools\n\n\tfunction onEpicsStateChange(epicsState: EpicsStateType) {\n\t\toutsideState = computeOutsideState(epicsState)\n\t\tstateChangedSubscribers.forEach(sub => sub((outsideState: any)))\n\t}\n\n\tlet batchDispatchIsInProgress: bool = false\n\n\tlet messagesAccumulatedDuringBatchDispatch: Array<any> = []\n\n\tlet epicsStateChangedCallbackAfterBatchDispatchComplete: () => void = () => undefined\n\n\tfunction dispatch(msg: { type: any }, meta?: MetaType = ({}: any)) {\n\t\tconst messagesToSendOutside = []\n\t\tconst epicsStateUpdate = {}\n\t\tconst effectManagersStateUpdate = {}\n\n\t\tif (meta.targetEpicVcet) {\n\t\t\t(msg: any).targetEpicVcetMap = meta.targetEpicVcet.reduce(\n\t\t\t\t(m,v) => {\n\t\t\t\t\tm[v] = true\n\t\t\t\t\treturn m\n\t\t\t\t},\n\t\t\t\t{}\n\t\t\t)\n\t\t}\n\t\tlet\tupdatedConditionsValues\n\n\t\tlet updatedEpicsState\n\n\t\tlet updatedEffectManagersState\n\t\tconst batchedDispatchBatches = []\n\n\t\tif (msg.type === effectPromiseCompleteAT) {\n\t\t\tconst { effect, error, effectRequestType } = ((msg: any): {| effect: {||}, effectRequestType: string, error: Error |})\n\t\t\tconst effectManagerState = serviceState.effectManagers[effectRequestType]\n\n\t\t\teffectManagersStateUpdate[effectRequestType] = {\n\t\t\t\t...effectManagersStateUpdate[effectRequestType],\n\t\t\t\tpendingEffects: effectManagerState.pendingEffects.filter(pe => pe.effect !== effect),\n\t\t\t}\n\t\t\tif (error) {\n\t\t\t\twarn(`Effect ${effectRequestType} error ${error.message}.`, effect, error)\n\t\t\t}\n\t\t} else {\n\t\t\tconst conditionsValuesUpdate = {}\n\t\t\tconst executionLevelTrace = { triggerMsg: msg, executedEpics: [] }\n\n\t\t\texecuteMsg({\n\t\t\t\tmsgsChain: [msg],\n\t\t\t\tconditionsValues: serviceState.conditions,\n\t\t\t\tprevConditionsValues: {},\n\t\t\t\tconditionsValuesUpdate,\n\t\t\t\tepicsState: serviceState.epics,\n\t\t\t\tepicsStateUpdate,\n\t\t\t\teffectManagersState: serviceState.effectManagers,\n\t\t\t\teffectManagersStateUpdate,\n\t\t\t\tlastReducerValuesByEpicVcetUpdaterKey: {},\n\t\t\t\tmessagesToSendOutside,\n\t\t\t\tbatchedDispatchBatches,\n\t\t\t\texecutionLevelTrace,\n\t\t\t})\n\t\t\tif (trace) trace(executionLevelTrace)\n\t\t\tif (Object.keys(conditionsValuesUpdate).length !== 0) {\n\t\t\t\tupdatedConditionsValues = { ...serviceState.conditions,\t...conditionsValuesUpdate }\n\t\t\t}\n\t\t\tconst updatedEpicsTypes = Object.keys(epicsStateUpdate)\n\t\t\tconst noBatchDispatchBatches = batchedDispatchBatches.length === 0\n\n\t\t\tif (updatedEpicsTypes.length !== 0) {\n\t\t\t\tupdatedEpicsState = mergeEpicsStateWithUpdate(serviceState.epics, epicsStateUpdate)\n\n\t\t\t\tif (!batchDispatchIsInProgress && noBatchDispatchBatches) {\n\t\t\t\t\tonEpicsStateChange(updatedEpicsState)\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (batchDispatchIsInProgress || !noBatchDispatchBatches) {\n\t\t\t\tmessagesAccumulatedDuringBatchDispatch.push(...messagesToSendOutside)\n\t\t\t} else {\n\t\t\t\tmessagesToSendOutside.forEach(m => outMsgSubscribers.forEach(sub => sub(m)))\n\t\t\t}\n\t\t}\n\t\tif (Object.keys(effectManagersStateUpdate).length) {\n\t\t\tupdatedEffectManagersState = mergeEffectManagersStateWithUpdate(serviceState.effectManagers, effectManagersStateUpdate)\n\t\t}\n\t\tif (updatedConditionsValues || updatedEpicsState ||\tupdatedEffectManagersState) {\n\t\t\tconst nextServiceState = {\n\t\t\t\tepics: updatedEpicsState || serviceState.epics,\n\t\t\t\tconditions: updatedConditionsValues || serviceState.conditions,\n\t\t\t\teffectManagers: updatedEffectManagersState || serviceState.effectManagers,\n\t\t\t}\n\n\t\t\tif (devTools && Object.keys(epicsStateUpdate).length) {\n\t\t\t\tlet atLeastOneChange = false\n\n\t\t\t\tObject.keys(epicsStateUpdate).forEach(vcet => {\n\t\t\t\t\tif (atLeastOneChange) return\n\t\t\t\t\tconst epicState = serviceState.epics[vcet]\n\t\t\t\t\tconst epicStateUpdate = epicsStateUpdate[vcet]\n\n\t\t\t\t\tif (\n\t\t\t\t\t\t(epicStateUpdate.state !== undefined && !deepEqual(epicState.state, epicStateUpdate.state))\n\t\t\t\t\t\t|| (epicStateUpdate.scope !== undefined && !deepEqual(epicState.scope, epicStateUpdate.scope))\n\t\t\t\t\t\t|| (epicStateUpdate.updatersState !== undefined && !deepEqual(epicState.updatersState, epicStateUpdate.updatersState))\n\t\t\t\t\t) {\n\t\t\t\t\t\tatLeastOneChange = true\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tif (atLeastOneChange) {\n\t\t\t\t\tdevTools.send(msg, nextServiceState)\n\t\t\t\t}\n\t\t\t}\n\t\t\tserviceState = nextServiceState\n\n\t\t\tif (batchedDispatchBatches.length) {\n\t\t\t\tbatchDispatchIsInProgress = true\n\n\t\t\t\tlet atLeastOneChange = false\n\n\t\t\t\tbatchedDispatchBatches.forEach(({ msgs, targetEpicVcet }) => {\n\t\t\t\t\tconst epicSubStore = epicsSubStoresByVcet[targetEpicVcet]\n\n\t\t\t\t\tepicSubStore._setState({\n\t\t\t\t\t\tepics: { [targetEpicVcet]: serviceState.epics[targetEpicVcet] },\n\t\t\t\t\t\tconditions: {},\n\t\t\t\t\t\teffectManagers: {},\n\t\t\t\t\t})\n\t\t\t\t\tmsgs.forEach(a => epicSubStore.dispatch(a))\n\n\t\t\t\t\tconst currentEpicState = serviceState.epics[targetEpicVcet]\n\t\t\t\t\tconst newEpicStateState = epicSubStore.getState()[targetEpicVcet]\n\n\t\t\t\t\tdispatch({ type: targetEpicVcet, value: newEpicStateState })\n\n\t\t\t\t\tif (currentEpicState.state !== newEpicStateState) {\n\t\t\t\t\t\tserviceState.epics = { ...serviceState.epics, [targetEpicVcet]: { ...currentEpicState, state: newEpicStateState } }\n\t\t\t\t\t\tatLeastOneChange = true\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tif (atLeastOneChange || updatedEpicsState) {\n\t\t\t\t\tonEpicsStateChange(serviceState.epics)\n\t\t\t\t}\n\n\t\t\t\tmessagesAccumulatedDuringBatchDispatch.forEach(m => outMsgSubscribers.forEach(sub => sub(m)))\n\t\t\t\tepicsStateChangedCallbackAfterBatchDispatchComplete()\n\n\t\t\t\tbatchDispatchIsInProgress = false\n\t\t\t\tmessagesAccumulatedDuringBatchDispatch = []\n\t\t\t\tepicsStateChangedCallbackAfterBatchDispatchComplete = () => undefined\n\t\t\t}\n\t\t}\n\t}\n\n\tconst pluginInitializationComplete = false\n\n\tgetObjectKeys(plugins).forEach(pluginKey => {\n\t\tconst plugin: PluginType = plugins[pluginKey]\n\n\t\tplugin({\n\t\t\tinjectUpdaters: injector => getObjectKeys(epics).forEach(epicKey => {\n\t\t\t\tconst epic = epics[epicKey]\n\t\t\t\tconst updatersMapToInject = injector(epic)\n\n\t\t\t\tif (!updatersMapToInject) return\n\t\t\t\tconst updatersKeysToInject = getObjectKeys(updatersMapToInject)\n\n\t\t\t\tif (updatersKeysToInject.length) {\n\t\t\t\t\tupdatersKeysToInject.forEach(k => {\n\t\t\t\t\t\tepic.updaters = { ...epic.updaters,\t[`${pluginKey}/${k}`]: updatersMapToInject[k] }\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}),\n\t\t\tinjectEpics: epicsToInject => {\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tepics = { ...epics, ...getObjectKeys(epicsToInject).reduce((r,k) => ({ ...r, [createPluginStateKey(k)]: epicsToInject[k] }), {})}\n\t\t\t},\n\t\t\tgetEpics: () => {\n\t\t\t\tif (!pluginInitializationComplete) {throw new Error('getEpics can not be used during plugin initialization because they are not in the final state yet.')}\n\t\t\t\treturn epics\n\t\t\t},\n\t\t\tgetEpicsWithPluginConfig: () => {\n\t\t\t\treturn getObjectKeys(epics).filter(key => epics[key].pluginConfig).map(key => ({ key, ...epics[key] }))\n\t\t\t},\n\t\t})\n\t})\n\tepics = deepCopy(epics) // eslint-disable-line no-param-reassign\n\tconst epicsSubStoresByVcet = isSubStore ? {} : createEpicsSubStoresByVcet(epics)\n\n\tif (!isSubStore) {\n\t\tvalidateUniqVcet(epics)\n\t\tvalidateResetConditions(epics)\n\t\tvalidateEpicConditions(epics)\n\t}\n\n\tconst rootConditionsByMsgType = processConditionsSubscriptions(epics)\n\n\tif (__DEV__) {\n\t\tdeepFreeze(epics)\n\t\tdeepFreeze(effectManagers)\n\t\tdeepFreeze(plugins)\n\t}\n\tconst epicKeyByVcet = getObjectKeys(epics).reduce((m, epicKey) => ({ ...m, [epics[epicKey].vcet]: epicKey }), {})\n\tconst epicsArr = values(epics)\n\tconst epicsMapByVcet = values(epics).reduce((a, e) => ({ ...a, [e.vcet]: e }), {})\n\tconst executeMsg = createExecuteMsg({\n\t\ttrace,\n\t\tepicsMapByVcet,\n\t\tepicKeyByVcet,\n\t\twarn,\n\t\teffectManagers,\n\t\tdispatch,\n\t\trootConditionsByMsgType,\n\t})\n\tconst epicsVcetToStateKeyMap = Object.keys(epics).reduce((r, epicStateKey) => {\n\t\tr[epics[epicStateKey].vcet] = epicStateKey\n\t\treturn r\n\t}, {})\n\tconst computeOutsideState = createComputeOutsideState({ epicsVcetToStateKeyMap })\n\tconst { initialEpicsState, initialCondtionsValues } = computeInitialStates({\n\t\tepicsArr,\n\t\twarn,\n\t\texecuteMsg,\n\t\ttrace,\n\t})\n\n\tlet\tserviceState: ServiceStateType = {\n\t\tconditions: initialCondtionsValues,\n\t\tepics: initialEpicsState,\n\t\teffectManagers: getEffectManagersInitialState(effectManagers),\n\t}\n\n\tlet outsideState = computeOutsideState(serviceState.epics)\n\n\tfunction getAllPendingEffectsPromises() {\n\t\treturn Object.keys(serviceState.effectManagers).reduce((pendingEffectsPromises, requestEffectType) => {\n\t\t\tpendingEffectsPromises.push(...serviceState.effectManagers[requestEffectType]\n\t\t\t\t.pendingEffects.map(({ promise, effect }) => ({ promise,\n\t\t\t\t\trequestEffectType,\n\t\t\t\t\teffect })))\n\t\t\treturn pendingEffectsPromises\n\t\t}, [])\n\t}\n\tconst stateChangedSubscribers = []\n\tconst outMsgSubscribers = []\n\n\tif (debug && devToolsConfig && typeof window !== 'undefined' && window.__REDUX_DEVTOOLS_EXTENSION__) {\n\t\tdevTools = window.__REDUX_DEVTOOLS_EXTENSION__.connect({ ...devToolsConfig, name: 'service' })\n\t\tdevTools.subscribe((message) => {\n\t\t\tif (message.type === 'DISPATCH' && message.state) {\n\t\t\t\tserviceState = JSON.parse(message.state)\n\t\t\t\tonEpicsStateChange(serviceState.epics)\n\t\t\t}\n\t\t})\n\t\tdevTools.init(serviceState)\n\t}\n\tif (!isSubStore) {\n\t\tdispatch(storeCreatedEvent.create())\n\t}\n\n\tlet storeReplacement\n\n\tconst initialState = serviceState\n\n\treturn {\n\t\t_getServiceState: () => {\n\t\t\tif (storeReplacement) return storeReplacement._getServiceState()\n\t\t\treturn serviceState\n\t\t},\n\t\t_getNextStateForMsgWithoutUpdatingStoreState: (msg) => {\n\t\t\tif (storeReplacement) {\n\t\t\t\treturn storeReplacement._getNextStateForMsgWithoutUpdatingStoreState(msg)\n\t\t\t}\n\t\t\tconst epicsStateUpdate = {}\n\t\t\tconst conditionsValuesUpdate = {}\n\t\t\tconst effectManagersStateUpdate = {}\n\n\t\t\texecuteMsg({\n\t\t\t\tmsgsChain: [msg],\n\t\t\t\tconditionsValues: serviceState.conditions,\n\t\t\t\tprevConditionsValues: {},\n\t\t\t\tconditionsValuesUpdate,\n\t\t\t\tepicsState: serviceState.epics,\n\t\t\t\tepicsStateUpdate,\n\t\t\t\teffectManagersState: serviceState.effectManagers,\n\t\t\t\teffectManagersStateUpdate,\n\t\t\t\tlastReducerValuesByEpicVcetUpdaterKey: {},\n\t\t\t\tmessagesToSendOutside: [],\n\t\t\t\tbatchedDispatchBatches: [],\n\t\t\t\texecutionLevelTrace: undefined,\n\t\t\t})\n\t\t\tconst updatedEpicsTypes = Object.keys(epicsStateUpdate)\n\n\t\t\tif (updatedEpicsTypes.length !== 0) {\n\t\t\t\tconst updatedEpicsState = mergeEpicsStateWithUpdate(serviceState.epics, epicsStateUpdate)\n\n\t\t\t\tcomputeOutsideState(updatedEpicsState)\n\t\t\t}\n\n\t\t\treturn (computeOutsideState(serviceState.epics): any)\n\t\t},\n\t\t_setState(_serviceState: ServiceStateType): void {\n\t\t\tif (storeReplacement) {\n\t\t\t\tstoreReplacement._setState(_serviceState)\n\t\t\t} else {\n\t\t\t\tserviceState = _serviceState\n\t\t\t\toutsideState = computeOutsideState(serviceState.epics)\n\t\t\t}\n\t\t},\n\t\tdestroyEffects: () => {\n\t\t\tif (storeReplacement) {\n\t\t\t\tstoreReplacement.destroyEffects()\n\t\t\t} else {\n\t\t\t\tconsole.log('destroing effects')\n\t\t\t}\n\t\t},\n\t\trecreateEffects: () => {\n\t\t\tif (storeReplacement) {\n\t\t\t\tstoreReplacement.recreateEffects()\n\t\t\t} else {\n\t\t\t\tconsole.log('recreating effects')\n\t\t\t}\n\t\t},\n\t\treplaceConfig: (creaceEpicsStoreConfig) => {\n\t\t\tconst currentState: any = storeReplacement ? storeReplacement._getServiceState() : serviceState\n\n\t\t\tstoreReplacement = createStore(creaceEpicsStoreConfig)\n\t\t\tstoreReplacement._setState(currentState)\n\t\t\tstateChangedSubscribers.forEach(sub => storeReplacement.subscribeOnStateChange(sub))\n\t\t\toutMsgSubscribers.forEach(sub => storeReplacement.subscribeOutMsg(sub))\n\t\t\t// TODO dispose side effects\n\t\t},\n\t\tresetToInitialState: () => {\n\t\t\tserviceState = initialState\n\t\t},\n\t\tdispatch: (a: AnyMsgType, meta?: MetaType) => {\n\t\t\tif (storeReplacement) {\n\t\t\t\treturn storeReplacement.dispatch(a, meta)\n\t\t\t}\n\t\t\treturn dispatch(a)\n\t\t},\n\t\tgetState() {\n\t\t\tif (storeReplacement) {\n\t\t\t\treturn storeReplacement.getState()\n\t\t\t}\n\t\t\treturn (outsideState: any)\n\t\t},\n\t\tgetAllPendingEffectsPromises: () => {\n\t\t\tif (storeReplacement) {\n\t\t\t\treturn storeReplacement.getAllPendingEffectsPromises()\n\t\t\t}\n\t\t\treturn getAllPendingEffectsPromises()\n\t\t},\n\t\tsubscribeOnStateChange: subscriber => {\n\t\t\tif (storeReplacement) {\n\t\t\t\tstoreReplacement.subscribeOnStateChange(subscriber)\n\t\t\t}\n\t\t\tstateChangedSubscribers.push(subscriber)\n\t\t},\n\t\t// subscribe to messages that can be send from epics to 3rd party\n\t\tsubscribeOutMsg: sub => {\n\t\t\tif (storeReplacement) {\n\t\t\t\tstoreReplacement.subscribeOutMsg(sub)\n\t\t\t}\n\t\t\toutMsgSubscribers.push(sub)\n\t\t},\n\t\twarn,\n\t}\n}\n\nfunction makeMsg<MsgExtraFields>(messageType: string): {|\n\tcreate: MsgExtraFields => {| ...MsgExtraFields, type: string |},\n\tcondition: Condition<{| ...MsgExtraFields, type: string |}>,\n\tmatch: AnyMsgType => {| ...MsgExtraFields, type: string |} | void,\n\ttype: string,\n|} {\n\tconst create = extraFields => ({ type: messageType, ...extraFields })\n\tconst condition = createCondition(messageType)\n\n\treturn ({\n\t\tcreate,\n\t\tcondition,\n\t\tmatch: createConditionMatcher(condition),\n\t\ttype: messageType,\n\t})\n}\n\nfunction makeSimpleMsg(messageType: string): {|\n\tcreate: () => {| type: string |},\n\tcondition: Condition<{| type: string |}>,\n\tmatch: AnyMsgType => {| type: string |} | void,\n\ttype: string,\n|} {\n\tconst create = () => ({ type: messageType })\n\tconst condition = createCondition(messageType)\n\n\treturn ({\n\t\tcreate,\n\t\tcondition,\n\t\tmatch: createConditionMatcher(condition),\n\t\ttype: messageType,\n\t})\n}\n\nconst makeSimpleEvent = makeSimpleMsg\nconst makeEvent = makeMsg\nconst makeSimpleCommand = makeSimpleMsg\nconst makeCommand = makeMsg\n\nconst storeCreatedEvent = makeSimpleEvent('@STORE_CREATED')\n\nexport type { // eslint-disable-line import/group-exports\n\tCondition,\n\tBuiltInEffectType,\n\tCreateEffectManagerType,\n\tCreateConditionType,\n\tUpdaterType,\n\tEpicsStoreType,\n\tEpicType,\n\tDispatchType,\n\tPluginPropsType,\n\tPluginType,\n\tAnyValueType,\n\tAnyConditionType,\n\tAnyMsgType,\n}\n\nexport { // eslint-disable-line import/group-exports\n\tmakeSimpleEvent,\n\tmakeEvent,\n\tmakeSimpleCommand,\n\tmakeCommand,\n\tcreateEpic,\n\tcreateEpicWithScope,\n\tmatchAnyMsgCondition,\n\tcreateStore,\n\tdispatchMsgEffectCreator,\n\tdaEC,\n\tdispatchBatchedMsgsEffectCreator,\n\tsendMsgOutsideEpicsEffectCreator,\n\tcreateCondition,\n\tcreateEpicCondition,\n\tcreateUpdater,\n\tcreateEffectManager,\n\tdeepCopy,\n\tdeepEqual,\n\ttraceToString,\n\tstoreCreatedEvent,\n\tcreatePluginStateKey,\n\tgetObjectKeys,\n\tcreateConditionMatcher,\n}\n","// @flow strict\n\nimport { createStore } from './epicsFlow'\nimport { storeConfig } from './storeConfig'\n\n// eslint-disable-next-line no-undef\nglobal.$appSetup = (ctx) => {\n\tif (ctx.store) {\n\t\tctx.store.replaceConfig(storeConfig)\n\t\tctx.store.recreateEffects()\n\t} else {\n\t\tctx.store = createStore<typeof storeConfig.epics>(storeConfig)\n\t}\n\n\treturn () => {\n\t\tctx.store.destroyEffects()\n\t}\n}\n","// @flow strict\nimport { createEpic, createUpdater, makeSimpleCommand } from './epicsFlow'\n\nconst IncEvent = makeSimpleCommand('INC')\n\nconst storeConfig = {\n\tepics: {\n\t\ttest: createEpic<number, *, *>({\n\t\t\tinitialState: 2,\n\t\t\tvcet: 'TEST',\n\t\t\tupdaters: {\n\t\t\t\tinc: createUpdater({\n\t\t\t\t\tgiven: {},\n\t\t\t\t\twhen: { inc: IncEvent.condition },\n\t\t\t\t\tthen: ({R}) => R.mapState(i => i + 1),\n\t\t\t\t}),\n\t\t\t},\n\t\t}),\n\t},\n\tdebug: Boolean(process.env.NODE_ENV !== 'test' || process.env.TRACE),\n}\n\nexport {\n\tIncEvent,\n\tstoreConfig,\n}\n"],"sourceRoot":""}